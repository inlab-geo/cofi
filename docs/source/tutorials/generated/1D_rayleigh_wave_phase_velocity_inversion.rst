
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "tutorials/generated/1D_rayleigh_wave_phase_velocity_inversion.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_tutorials_generated_1D_rayleigh_wave_phase_velocity_inversion.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_tutorials_generated_1D_rayleigh_wave_phase_velocity_inversion.py:


1D Rayleigh wave phase velocity inversion
=========================================

.. GENERATED FROM PYTHON SOURCE LINES 9-14

|Open In Colab|

.. |Open In Colab| image:: https://img.shields.io/badge/open%20in-Colab-b5e2fa?logo=googlecolab&style=flat-square&color=ffd670
   :target: https://colab.research.google.com/github/inlab-geo/cofi-examples/blob/main/tutorials/rayleigh_wave_phase_velocity/1D_rayleigh_wave_phase_velocity_inversion.ipynb


.. GENERATED FROM PYTHON SOURCE LINES 17-24

If you are running this notebook locally, make sure you’ve followed
`steps
here <https://github.com/inlab-geo/cofi-examples#run-the-examples-with-cofi-locally>`__
to set up the environment. (This
`environment.yml <https://github.com/inlab-geo/cofi-examples/blob/main/envs/environment.yml>`__
file specifies a list of packages required to run the notebooks)


.. GENERATED FROM PYTHON SOURCE LINES 27-43

--------------

What we do in this notebook
---------------------------

Here we look at applying CoFI to the inversion of Rayleigh wave phase
velocities for a 1D layered earth.

**Learning outcomes**

-  A demonstration of CoFI’s ability to switch between parameter
   estimation and ensemble methods.
-  A comparison between different McMC samplers that is fixed-d and
   trans-d samplers
-  An application of CoFI to field data


.. GENERATED FROM PYTHON SOURCE LINES 43-54

.. code-block:: Python


    # -------------------------------------------------------- #
    #                                                          #
    #     Uncomment below to set up environment on "colab"     #
    #                                                          #
    # -------------------------------------------------------- #

    # !pip install -U cofi git+https://github.com/miili/pysurf96.git
    # !git clone https://github.com/inlab-geo/cofi-examples.git
    # %cd cofi-examples/examples/sw_rf_joint








.. GENERATED FROM PYTHON SOURCE LINES 56-65

.. code-block:: Python


    import numpy as np
    import scipy
    import matplotlib.pyplot as plt

    from pysurf96 import surf96
    import bayesbay
    import cofi








.. GENERATED FROM PYTHON SOURCE LINES 70-82

Problem description
-------------------

Here we illustrate the range of inversion methods made avaialbe by CoFI.
That is we first define a base problem and then explore the use of an
iterative non linear apporach to find the MAP solution and then employ a
range of Markov Chain Monte Carlo strategies to recover the posterior
distribution. The forward problem is solved using pysurf 96
(https://github.com/miili/pysurf96) and the field data example is taken
from (https://www.eas.slu.edu/eqc/eqc_cps/TUTORIAL/STRUCT/index.html)
and we will be inverting observed rayleigh wave phase velocities


.. GENERATED FROM PYTHON SOURCE LINES 85-87

**Inference problem**


.. GENERATED FROM PYTHON SOURCE LINES 87-96

.. code-block:: Python


    # display theory on the inference problem
    from IPython.display import display, Markdown

    with open("../../theory/geo_surface_wave_dispersion.md", "r") as f:
        content = f.read()

    display(Markdown(content))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    <IPython.core.display.Markdown object>




.. GENERATED FROM PYTHON SOURCE LINES 101-103

**Solving methods**


.. GENERATED FROM PYTHON SOURCE LINES 103-110

.. code-block:: Python


    # display theory on the optimisation approach
    with open("../../theory/inv_optimisation.md", "r") as f:
        content = f.read()

    display(Markdown(content))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    <IPython.core.display.Markdown object>




.. GENERATED FROM PYTHON SOURCE LINES 112-119

.. code-block:: Python


    # display theory on the optimisation approach
    with open("../../theory/inv_mcmc.md", "r") as f:
        content = f.read()

    display(Markdown(content))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    <IPython.core.display.Markdown object>




.. GENERATED FROM PYTHON SOURCE LINES 124-128

**Further reading**

https://en.wikipedia.org/wiki/Surface_wave_inversion


.. GENERATED FROM PYTHON SOURCE LINES 131-134

Utilities
---------


.. GENERATED FROM PYTHON SOURCE LINES 137-140

1D model paramterisation
~~~~~~~~~~~~~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 140-147

.. code-block:: Python


    # display theory on the 1D model parameterisation
    with open("../../theory/misc_1d_model_parameterisation.md", "r") as f:
        content = f.read()

    display(Markdown(content))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    <IPython.core.display.Markdown object>




.. GENERATED FROM PYTHON SOURCE LINES 149-162

.. code-block:: Python


    # layercake model utilities
    def form_layercake_model(thicknesses, vs):
        model = np.zeros((len(vs)*2-1,))
        model[1::2] = thicknesses
        model[::2] = vs
        return model

    def split_layercake_model(model):
        thicknesses = model[1::2]
        vs = model[::2]
        return thicknesses, vs








.. GENERATED FROM PYTHON SOURCE LINES 164-174

.. code-block:: Python


    # voronoi model utilities
    def form_voronoi_model(voronoi_sites, vs):
        return np.hstack((vs, voronoi_sites))

    def split_voronoi_model(model):
        voronoi_sites = model[len(model)//2:]
        vs = model[:len(model)//2]
        return voronoi_sites, vs








.. GENERATED FROM PYTHON SOURCE LINES 176-199

.. code-block:: Python


    def voronoi_to_layercake(voronoi_vector: np.ndarray) -> np.ndarray:
        n_layers = len(voronoi_vector) // 2
        velocities = voronoi_vector[:n_layers]
        voronoi_sites = voronoi_vector[n_layers:]
        depths = (voronoi_sites[:-1] + voronoi_sites[1:]) / 2
        thicknesses = depths - np.insert(depths[:-1], 0, 0)
        layercake_vector = np.zeros((2*n_layers-1,))
        layercake_vector[::2] = velocities
        layercake_vector[1::2] = thicknesses
        return layercake_vector

    def layercake_to_voronoi(layercake_vector: np.ndarray, first_voronoi_site: float = 0.0) -> np.ndarray:
        n_layers = len(layercake_vector) // 2 + 1
        thicknesses = layercake_vector[1::2]
        velocities = layercake_vector[::2]
        depths = np.cumsum(thicknesses)
        voronoi_sites = np.zeros((n_layers,))
        for i in range(1,len(voronoi_sites)):
            voronoi_sites[i] = 2 * depths[i-1] - voronoi_sites[i-1]
        voronoi_vector = np.hstack((velocities, voronoi_sites))
        return voronoi_vector








.. GENERATED FROM PYTHON SOURCE LINES 204-207

Forward solver
~~~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 207-214

.. code-block:: Python


    # display theory on the using the forward solver
    with open("../../theory/geo_surface_wave_dispersion2.md", "r") as f:
        content = f.read()

    display(Markdown(content))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    <IPython.core.display.Markdown object>




.. GENERATED FROM PYTHON SOURCE LINES 216-222

.. code-block:: Python


    # Constants
    VP_VS = 1.77
    RHO_VP_K = 0.32
    RHO_VP_B = 0.77








.. GENERATED FROM PYTHON SOURCE LINES 224-256

.. code-block:: Python


    # forward through pysurf96
    def forward_sw(model, periods):
        thicknesses, vs = split_layercake_model(model)
        thicknesses = np.append(thicknesses, 10)
        vp = vs * VP_VS
        rho = RHO_VP_K * vp + RHO_VP_B
        return surf96(
            thicknesses,
            vp,
            vs,
            rho,
            periods,
            wave="rayleigh",
            mode=1,
            velocity="phase",
            flat_earth=False,
        )

    # numerical jacobian
    def jacobian_sw(model, periods, fwd=forward_sw, relative_step=0.01):
        jacobian = np.zeros((len(periods), len(model)))
        original_dpred = fwd(model, periods)
        for i in range(len(model)):
            perturbed_model = model.copy()
            step = relative_step * model[i]
            perturbed_model[i] += step
            perturbed_dpred = fwd(perturbed_model, periods)
            derivative = (perturbed_dpred - original_dpred) / abs(step)
            jacobian[:, i] = derivative
        return jacobian








.. GENERATED FROM PYTHON SOURCE LINES 261-268

Visualisation
-------------

For conveninece we also implement two functions to plot the data here
the Rayleigh wave phase velocity and a model given in the layer based
parametrisation.


.. GENERATED FROM PYTHON SOURCE LINES 268-293

.. code-block:: Python


    def plot_model(model, ax=None, title="model", **kwargs):
        # process data
        thicknesses = np.append(model[1::2], max(model[1::2]))
        velocities = model[::2]
        y = np.insert(np.cumsum(thicknesses), 0, 0)
        x = np.insert(velocities, 0, velocities[0])
    
        # plot depth profile
        if ax is None:
            _, ax = plt.subplots()
        plotting_style = {
            "linewidth": kwargs.pop("linewidth", kwargs.pop("lw", 0.5)),
            "alpha": 0.2,
            "color": kwargs.pop("color", kwargs.pop("c", "blue")),
        }
        plotting_style.update(kwargs)
        ax.step(x, y, where="post", **plotting_style)
        if ax.get_ylim()[0] < ax.get_ylim()[1]:
            ax.invert_yaxis()
        ax.set_xlabel("Vs (km/s)")
        ax.set_ylabel("Depth (km)")
        ax.set_title(title)
        return ax








.. GENERATED FROM PYTHON SOURCE LINES 295-315

.. code-block:: Python


    def plot_data(rayleigh_phase_velocities, periods, ax=None, scatter=False, 
                  title="data", **kwargs):
        if ax is None:
            _, ax = plt.subplots()
        plotting_style = {
            "linewidth": kwargs.pop("linewidth", kwargs.pop("lw", 1)),
            "alpha": 1,
            "color": kwargs.pop("color", kwargs.pop("c", "blue")),
        }
        plotting_style.update(**kwargs)
        if scatter:
            ax.scatter(periods, rayleigh_phase_velocities, **plotting_style)
        else:
            ax.plot(periods, rayleigh_phase_velocities, **plotting_style)
        ax.set_xlabel("Periods (s)")
        ax.set_ylabel("Rayleigh phase velocities (km/s)")
        ax.set_title(title)
        return ax








.. GENERATED FROM PYTHON SOURCE LINES 317-334

.. code-block:: Python


    def plot_model_and_data(model, label_model, color_model, 
                            forward_func, periods, label_d_pred, color_d_pred, 
                            axes=None, light_thin=False):
        if axes is None:
            _, axes = plt.subplots(1, 2, figsize=(10, 4), gridspec_kw={"width_ratios": [1, 2.5]})
        ax1, ax2 = axes
        if light_thin:
            plot_model(model, ax=ax1, color=color_model, alpha=0.2, lw=0.5, label=label_model)
            plot_data(forward_func(model, periods), periods, ax=ax2, color=color_d_pred, alpha=0.2, lw=0.5, label=label_d_pred)
        else:
            plot_model(model, ax=ax1, color=color_model, alpha=1, lw=1, label=label_model)
            plot_data(forward_func(model, periods), periods, ax=ax2, color=color_d_pred, label=label_d_pred)
        ax1.legend()
        ax2.legend()
        return ax1, ax2








.. GENERATED FROM PYTHON SOURCE LINES 339-349

Synthetic example
-----------------

Prior to inverting any field data it is good practice to test an
inversion method using sythetic exmaples where we know the true model.
It is also recommended to prior to this idnepently test any forward
solver that is being used and verify the Jacobian, as problems related
to the forward sovler are diffiuclt to identify and diagnose once they
are integrated in an inversion methodology.


.. GENERATED FROM PYTHON SOURCE LINES 352-355

Generate synthetic data
~~~~~~~~~~~~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 355-362

.. code-block:: Python


    synth_d_periods = np.geomspace(3, 80, 20)

    true_thicknesses = np.array([10, 10, 15, 20, 20, 20, 20, 20])
    true_vs = np.array([3.38, 3.44, 3.66, 4.25, 4.35, 4.32, 4.315, 4.38, 4.5])
    true_model = form_layercake_model(true_thicknesses, true_vs)








.. GENERATED FROM PYTHON SOURCE LINES 364-369

.. code-block:: Python


    noise_level = 0.02
    d_true = forward_sw(true_model, synth_d_periods)
    d_obs = d_true + np.random.normal(0, 0.01, len(d_true))








.. GENERATED FROM PYTHON SOURCE LINES 371-381

.. code-block:: Python


    # plot true model and d_pred from true model
    _, ax2 = plot_model_and_data(model=true_model, label_model="true model", color_model="orange",
                        forward_func=forward_sw, periods=synth_d_periods, 
                        label_d_pred="true data (noiseless)", color_d_pred="orange")

    # plot d_obs
    plot_data(d_obs, synth_d_periods, ax=ax2, scatter=True, color="red", s=20, label="observed data (noisy)")
    ax2.legend();




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_001.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f8250ade950>



.. GENERATED FROM PYTHON SOURCE LINES 386-389

Optimisation
~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 392-394

**Prepare ``BaseProblem`` for optimisation**


.. GENERATED FROM PYTHON SOURCE LINES 394-401

.. code-block:: Python


    n_dims = 17

    init_thicknesses = np.ones((n_dims//2,)) * 15
    init_vs = np.ones((n_dims//2+1,)) * 4.0
    init_model = form_layercake_model(init_thicknesses, init_vs)








.. GENERATED FROM PYTHON SOURCE LINES 403-418

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="starting model", color_model="purple",
                               forward_func=forward_sw, periods=synth_d_periods, 
                               label_d_pred="data predictions from starting model", color_d_pred="purple")

    # plot the model and d_pred for true model
    plot_model_and_data(model=true_model, label_model="true model", color_model="orange",
                        forward_func=forward_sw, periods=synth_d_periods, 
                        label_d_pred="true data (noiseless)", color_d_pred="orange", axes=axes)

    # plot d_obs
    plot_data(d_obs, synth_d_periods, ax=axes[1], scatter=True, color="red", s=20, label="d_obs")
    axes[1].legend();




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_002.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_002.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f8248785a50>



.. GENERATED FROM PYTHON SOURCE LINES 420-427

.. code-block:: Python


    my_reg = cofi.utils.QuadraticReg(
        weighting_matrix="damping", 
        model_shape=(n_dims,), 
        reference_model=init_model
    )








.. GENERATED FROM PYTHON SOURCE LINES 429-449

.. code-block:: Python


    def my_objective(model, fwd, periods, d_obs, lamda=1.0):
        d_pred = fwd(model, periods)
        data_misfit = np.sum((d_obs - d_pred) ** 2)
        reg = my_reg(model)
        return data_misfit + lamda * reg

    def my_objective_gradient(model, fwd, periods, d_obs, lamda=1.0):
        d_pred = fwd(model, periods)
        jac = jacobian_sw(model, periods, fwd)
        data_misfit_grad = -2 * jac.T @ (d_obs - d_pred)
        reg_grad = my_reg.gradient(model)
        return data_misfit_grad + lamda * reg_grad

    def my_objective_hessian(model, fwd, periods, d_obs, lamda=1.0):
        jac = jacobian_sw(model, periods, fwd)
        data_misfit_hess = 2 * jac.T @ jac
        reg_hess = my_reg.hessian(model)
        return data_misfit_hess + lamda * reg_hess








.. GENERATED FROM PYTHON SOURCE LINES 454-457

Optimisation with no damping
^^^^^^^^^^^^^^^^^^^^^^^^^^^^


.. GENERATED FROM PYTHON SOURCE LINES 457-472

.. code-block:: Python


    lamda = 0

    kwargs = {
        "fwd": forward_sw, 
        "periods": synth_d_periods, 
        "d_obs": d_obs, 
        "lamda": lamda
    }
    sw_problem_no_reg = cofi.BaseProblem()
    sw_problem_no_reg.set_objective(my_objective, kwargs=kwargs)
    sw_problem_no_reg.set_gradient(my_objective_gradient, kwargs=kwargs)
    sw_problem_no_reg.set_hessian(my_objective_hessian, kwargs=kwargs)
    sw_problem_no_reg.set_initial_model(init_model)








.. GENERATED FROM PYTHON SOURCE LINES 477-479

**Define ``InversionOptions``**


.. GENERATED FROM PYTHON SOURCE LINES 479-484

.. code-block:: Python


    inv_options_optimiser = cofi.InversionOptions()
    inv_options_optimiser.set_tool("scipy.optimize.minimize")
    inv_options_optimiser.set_params(method="trust-exact")








.. GENERATED FROM PYTHON SOURCE LINES 489-491

**Define ``Inversion`` and run**


.. GENERATED FROM PYTHON SOURCE LINES 491-495

.. code-block:: Python


    inv_optimiser_no_reg = cofi.Inversion(sw_problem_no_reg, inv_options_optimiser)
    inv_result_optimiser_no_reg = inv_optimiser_no_reg.run()








.. GENERATED FROM PYTHON SOURCE LINES 500-502

**Plot results**


.. GENERATED FROM PYTHON SOURCE LINES 502-522

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="starting model", color_model="black",
                               forward_func=forward_sw, periods=synth_d_periods, 
                               label_d_pred="d_pred from starting model", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=true_model, label_model="true model", color_model="orange",
                        forward_func=forward_sw, periods=synth_d_periods, 
                        label_d_pred="d_pred from true model", color_d_pred="orange", axes=axes)

    # plot the model and d_pred for inverted model
    plot_model_and_data(model=inv_result_optimiser_no_reg.model, label_model="inverted model", color_model="purple",
                        forward_func=forward_sw, periods=synth_d_periods,
                        label_d_pred="d_pred from inverted model", color_d_pred="purple", axes=axes);

    # plot d_obs
    plot_data(d_obs, synth_d_periods, ax=axes[1], scatter=True, color="red", s=20, label="d_obs")
    axes[1].legend();




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_003.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f82498c9000>



.. GENERATED FROM PYTHON SOURCE LINES 527-537

Optimal damping
^^^^^^^^^^^^^^^

Obviously we get a very skewed 1D model out of an optimisation that
solely tries to minimise the data misfit. We would like to add a damping
term to our objective function, but we are not sure which factor suits
the problem well.

In this situation, the ``InversionPool`` from CoFI can be handy.


.. GENERATED FROM PYTHON SOURCE LINES 537-572

.. code-block:: Python


    lambdas = np.logspace(-6, 6, 15)

    my_lcurve_problems = []
    for lamb in lambdas:
        my_problem = cofi.BaseProblem()
        kwargs = {
            "fwd": forward_sw, 
            "periods": synth_d_periods, 
            "d_obs": d_obs, 
            "lamda": lamb
        }
        my_problem.set_objective(my_objective, kwargs=kwargs)
        my_problem.set_gradient(my_objective_gradient, kwargs=kwargs)
        my_problem.set_hessian(my_objective_hessian, kwargs=kwargs)
        my_problem.set_initial_model(init_model)
        my_lcurve_problems.append(my_problem)

    def my_callback(inv_result, i):
        m = inv_result.model
        res_norm = np.linalg.norm(forward_sw(m, synth_d_periods) - d_obs)
        reg_norm = np.sqrt(my_reg(m))
        print(f"Finished inversion with lambda={lambdas[i]}: {res_norm}, {reg_norm}")
        return res_norm, reg_norm

    my_inversion_pool = cofi.utils.InversionPool(
        list_of_inv_problems=my_lcurve_problems,
        list_of_inv_options=inv_options_optimiser,
        callback=my_callback,
        parallel=False
    )
    all_res, all_cb_returns = my_inversion_pool.run()

    l_curve_points = list(zip(*all_cb_returns))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Finished inversion with lambda=1e-06: 0.0295240026574496, 6.291284257449492
    Finished inversion with lambda=7.196856730011514e-06: 0.02784711435958267, 6.375518151986621
    Finished inversion with lambda=5.1794746792312125e-05: 0.03907383353672954, 1.6268560625132509
    Finished inversion with lambda=0.0003727593720314938: 0.04054140382635009, 1.1684867175083642
    Finished inversion with lambda=0.0026826957952797246: 0.04096291062355648, 1.1522534970590785
    Finished inversion with lambda=0.019306977288832496: 0.04882321581888883, 1.1234071715576421
    Finished inversion with lambda=0.1389495494373136: 0.15354927026999712, 0.9860366603507283
    Finished inversion with lambda=1.0: 0.5032002697806788, 0.6624336040357746
    Finished inversion with lambda=7.196856730011514: 1.1075651578345815, 0.3156560305545735
    Finished inversion with lambda=51.79474679231202: 1.6362512269275336, 0.06811779848652416
    Finished inversion with lambda=372.7593720314938: 1.761979278142771, 0.010190104616695011
    Finished inversion with lambda=2682.6957952797275: 1.7809847776609822, 0.001430302096136427
    Finished inversion with lambda=19306.977288832455: 1.7836586535468215, 0.00019908249071669292
    Finished inversion with lambda=138949.5494373136: 1.7840356344470711, 2.766805613210966e-05
    Finished inversion with lambda=1000000.0: 1.7840873198916838, 3.844568156910166e-06




.. GENERATED FROM PYTHON SOURCE LINES 574-578

.. code-block:: Python


    # print all the lambdas
    lambdas





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array([1.00000000e-06, 7.19685673e-06, 5.17947468e-05, 3.72759372e-04,
           2.68269580e-03, 1.93069773e-02, 1.38949549e-01, 1.00000000e+00,
           7.19685673e+00, 5.17947468e+01, 3.72759372e+02, 2.68269580e+03,
           1.93069773e+04, 1.38949549e+05, 1.00000000e+06])



.. GENERATED FROM PYTHON SOURCE LINES 583-585

**Plot L-curve**


.. GENERATED FROM PYTHON SOURCE LINES 585-594

.. code-block:: Python


    # plot the L-curve
    res_norm, reg_norm = l_curve_points
    plt.plot(reg_norm, res_norm, '.-')
    plt.xlabel(r'Norm of regularization term $||Wm||_2$')
    plt.ylabel(r'Norm of residual $||g(m)-d||_2$')
    for i in range(0, len(lambdas), 2):
        plt.annotate(f'{lambdas[i]:.1e}', (reg_norm[i], res_norm[i]), fontsize=8)




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_004.png
   :alt: 1D rayleigh wave phase velocity inversion
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_004.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 599-605

Optimisation with damping
^^^^^^^^^^^^^^^^^^^^^^^^^

From the L-curve plot above, it seems that a damping factor of around
0.02 would be good.


.. GENERATED FROM PYTHON SOURCE LINES 605-620

.. code-block:: Python


    lamda = 0.02

    kwargs = {
        "fwd": forward_sw, 
        "periods": synth_d_periods, 
        "d_obs": d_obs, 
        "lamda": lamda
    }
    sw_problem = cofi.BaseProblem()
    sw_problem.set_objective(my_objective, kwargs=kwargs)
    sw_problem.set_gradient(my_objective_gradient, kwargs=kwargs)
    sw_problem.set_hessian(my_objective_hessian, kwargs=kwargs)
    sw_problem.set_initial_model(init_model)








.. GENERATED FROM PYTHON SOURCE LINES 625-627

**Define ``Inversion`` and run**


.. GENERATED FROM PYTHON SOURCE LINES 627-631

.. code-block:: Python


    inv_optimiser = cofi.Inversion(sw_problem, inv_options_optimiser)
    inv_result_optimiser = inv_optimiser.run()








.. GENERATED FROM PYTHON SOURCE LINES 636-638

**Plot results**


.. GENERATED FROM PYTHON SOURCE LINES 638-658

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="starting model", color_model="black",
                               forward_func=forward_sw, periods=synth_d_periods, 
                               label_d_pred="d_pred from starting model", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=true_model, label_model="true model", color_model="orange",
                        forward_func=forward_sw, periods=synth_d_periods, 
                        label_d_pred="d_pred from true model", color_d_pred="orange", axes=axes)

    # plot the model and d_pred for damped solution, and d_obs
    plot_model_and_data(model=inv_result_optimiser.model, label_model="damped solution", color_model="purple",
                        forward_func=forward_sw, periods=synth_d_periods,
                        label_d_pred="d_pred from damped solution", color_d_pred="purple", axes=axes);

    # plot d_obs
    plot_data(d_obs, synth_d_periods, ax=axes[1], scatter=True, color="red", s=20, label="d_obs")
    axes[1].legend();




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_005.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_005.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f8250a2e4d0>



.. GENERATED FROM PYTHON SOURCE LINES 663-666

Fixed-dimensional sampling
~~~~~~~~~~~~~~~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 669-671

**Prepare ``BaseProblem`` for fixed-dimensional sampling**


.. GENERATED FROM PYTHON SOURCE LINES 671-686

.. code-block:: Python


    thick_min = 5
    thick_max = 30
    vs_min = 2
    vs_max = 5

    def my_log_prior(model):
        thicknesses, vs = split_layercake_model(model)
        thicknesses_out_of_bounds = (thicknesses < thick_min) | (thicknesses > thick_max)
        vs_out_of_bounds = (vs < vs_min) | (vs > vs_max)
        if np.any(thicknesses_out_of_bounds) or np.any(vs_out_of_bounds):
            return float("-inf")
        log_prior = -np.log(thick_max - thick_min) * len(thicknesses) - np.log(vs_max - vs_min) * len(vs)
        return log_prior








.. GENERATED FROM PYTHON SOURCE LINES 688-699

.. code-block:: Python


    Cdinv = np.eye(len(d_obs))/(noise_level**2)      # inverse data covariance matrix

    def my_log_likelihood(model):
        try:
            d_pred = forward_sw(model, synth_d_periods)
        except:
            return float("-inf")
        residual = d_obs - d_pred
        return -0.5 * residual @ (Cdinv @ residual).T








.. GENERATED FROM PYTHON SOURCE LINES 701-708

.. code-block:: Python


    n_walkers = 40

    my_walkers_start = np.ones((n_walkers, n_dims)) * inv_result_optimiser.model
    for i in range(n_walkers):
        my_walkers_start[i,:] += np.random.normal(0, 0.3, n_dims)








.. GENERATED FROM PYTHON SOURCE LINES 710-714

.. code-block:: Python


    sw_problem.set_log_prior(my_log_prior)
    sw_problem.set_log_likelihood(my_log_likelihood)








.. GENERATED FROM PYTHON SOURCE LINES 719-721

**Define ``InversionOptions``**


.. GENERATED FROM PYTHON SOURCE LINES 721-732

.. code-block:: Python


    inv_options_fixed_d_sampling = cofi.InversionOptions()
    inv_options_fixed_d_sampling.set_tool("emcee")
    inv_options_fixed_d_sampling.set_params(
        nwalkers=n_walkers, 
        nsteps=2_000, 
        initial_state=my_walkers_start, 
        skip_initial_state_check=True, 
        progress=True
    )








.. GENERATED FROM PYTHON SOURCE LINES 737-739

**Define ``Inversion`` and run**


.. GENERATED FROM PYTHON SOURCE LINES 742-747

We will disable the display of warnings temporarily due to the
unavoidable existence of ``-inf`` in our prior.

https://github.com/dfm/emcee/issues/370#issuecomment-1013623444


.. GENERATED FROM PYTHON SOURCE LINES 747-750

.. code-block:: Python


    np.seterr(all="ignore");





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    {'divide': 'ignore', 'over': 'ignore', 'under': 'ignore', 'invalid': 'ignore'}



.. GENERATED FROM PYTHON SOURCE LINES 755-758

Sample the prior
^^^^^^^^^^^^^^^^


.. GENERATED FROM PYTHON SOURCE LINES 758-765

.. code-block:: Python


    prior_sampling_problem = cofi.BaseProblem()
    prior_sampling_problem.set_log_posterior(my_log_prior)
    prior_sampling_problem.set_model_shape(init_model.shape)
    prior_sampler = cofi.Inversion(prior_sampling_problem, inv_options_fixed_d_sampling)
    prior_results = prior_sampler.run()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/2000 [00:00<?, ?it/s]      6%|▌         | 111/2000 [00:00<00:01, 1103.47it/s]     11%|█         | 223/2000 [00:00<00:01, 1108.44it/s]     17%|█▋        | 335/2000 [00:00<00:01, 1110.57it/s]     22%|██▏       | 447/2000 [00:00<00:01, 1113.69it/s]     28%|██▊       | 559/2000 [00:00<00:01, 1114.81it/s]     34%|███▎      | 672/2000 [00:00<00:01, 1117.56it/s]     39%|███▉      | 785/2000 [00:00<00:01, 1120.27it/s]     45%|████▍     | 898/2000 [00:00<00:00, 1108.91it/s]     51%|█████     | 1012/2000 [00:00<00:00, 1116.11it/s]     56%|█████▋    | 1126/2000 [00:01<00:00, 1122.08it/s]     62%|██████▏   | 1241/2000 [00:01<00:00, 1129.53it/s]     68%|██████▊   | 1356/2000 [00:01<00:00, 1134.87it/s]     74%|███████▎  | 1471/2000 [00:01<00:00, 1137.93it/s]     79%|███████▉  | 1587/2000 [00:01<00:00, 1142.85it/s]     85%|████████▌ | 1703/2000 [00:01<00:00, 1147.72it/s]     91%|█████████ | 1820/2000 [00:01<00:00, 1152.46it/s]     97%|█████████▋| 1937/2000 [00:01<00:00, 1156.31it/s]    100%|██████████| 2000/2000 [00:01<00:00, 1132.90it/s]




.. GENERATED FROM PYTHON SOURCE LINES 767-789

.. code-block:: Python


    import arviz as az

    labels = ["v0", "t0", "v1", "t1", "v2", "t2", "v3", "t3", "v4", "t4", "v5", "t5", "v6", "t6", "v7", "t7", "v8"]

    prior_results_sampler = prior_results.sampler
    az_idata_prior = az.from_emcee(prior_results_sampler, var_names=labels)

    axes = az.plot_trace(
        az_idata_prior, 
        backend_kwargs={"constrained_layout":True}, 
        figsize=(10,20),
    )

    for i, axes_pair in enumerate(axes):
        ax1 = axes_pair[0]
        ax2 = axes_pair[1]
        ax1.set_xlabel("parameter value")
        ax1.set_ylabel("density value")
        ax2.set_xlabel("number of iterations")
        ax2.set_ylabel("parameter value")




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_006.png
   :alt: v0, v0, t0, t0, v1, v1, t1, t1, v2, v2, t2, t2, v3, v3, t3, t3, v4, v4, t4, t4, v5, v5, t5, t5, v6, v6, t6, t6, v7, v7, t7, t7, v8, v8
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_006.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 794-797

Sample the posterior
^^^^^^^^^^^^^^^^^^^^


.. GENERATED FROM PYTHON SOURCE LINES 797-801

.. code-block:: Python


    inversion_fixed_d_sampler = cofi.Inversion(sw_problem, inv_options_fixed_d_sampling)
    inv_result_fixed_d_sampler = inversion_fixed_d_sampler.run()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/2000 [00:00<?, ?it/s]      0%|          | 6/2000 [00:00<00:38, 51.58it/s]      1%|          | 12/2000 [00:00<00:50, 39.47it/s]      1%|          | 17/2000 [00:00<00:46, 42.65it/s]      1%|          | 22/2000 [00:00<00:44, 44.07it/s]      1%|▏         | 27/2000 [00:00<00:43, 45.50it/s]      2%|▏         | 32/2000 [00:00<00:42, 46.66it/s]      2%|▏         | 38/2000 [00:00<00:41, 47.79it/s]      2%|▏         | 44/2000 [00:00<00:39, 49.35it/s]      2%|▎         | 50/2000 [00:01<00:38, 50.43it/s]      3%|▎         | 56/2000 [00:01<00:37, 51.18it/s]      3%|▎         | 62/2000 [00:01<00:36, 52.58it/s]      3%|▎         | 68/2000 [00:01<00:35, 53.95it/s]      4%|▍         | 75/2000 [00:01<00:34, 56.50it/s]      4%|▍         | 81/2000 [00:01<00:33, 57.10it/s]      4%|▍         | 87/2000 [00:01<00:33, 57.28it/s]      5%|▍         | 93/2000 [00:01<00:33, 57.15it/s]      5%|▌         | 100/2000 [00:01<00:32, 58.57it/s]      5%|▌         | 106/2000 [00:02<00:32, 58.65it/s]      6%|▌         | 113/2000 [00:02<00:31, 60.10it/s]      6%|▌         | 120/2000 [00:02<00:31, 59.92it/s]      6%|▋         | 126/2000 [00:02<00:31, 59.62it/s]      7%|▋         | 133/2000 [00:02<00:30, 60.50it/s]      7%|▋         | 140/2000 [00:02<00:30, 61.28it/s]      7%|▋         | 147/2000 [00:02<00:30, 61.18it/s]      8%|▊         | 154/2000 [00:02<00:29, 61.75it/s]      8%|▊         | 161/2000 [00:02<00:29, 62.73it/s]      8%|▊         | 168/2000 [00:03<00:29, 63.13it/s]      9%|▉         | 175/2000 [00:03<00:28, 63.65it/s]      9%|▉         | 182/2000 [00:03<00:28, 64.67it/s]      9%|▉         | 189/2000 [00:03<00:27, 65.98it/s]     10%|▉         | 196/2000 [00:03<00:27, 65.76it/s]     10%|█         | 203/2000 [00:03<00:27, 65.26it/s]     10%|█         | 210/2000 [00:03<00:27, 65.43it/s]     11%|█         | 217/2000 [00:03<00:27, 65.41it/s]     11%|█         | 224/2000 [00:03<00:26, 66.20it/s]     12%|█▏        | 231/2000 [00:03<00:26, 65.93it/s]     12%|█▏        | 238/2000 [00:04<00:26, 65.73it/s]     12%|█▏        | 245/2000 [00:04<00:26, 66.27it/s]     13%|█▎        | 252/2000 [00:04<00:26, 66.40it/s]     13%|█▎        | 259/2000 [00:04<00:25, 67.36it/s]     13%|█▎        | 267/2000 [00:04<00:25, 68.78it/s]     14%|█▍        | 275/2000 [00:04<00:24, 70.42it/s]     14%|█▍        | 283/2000 [00:04<00:24, 70.92it/s]     15%|█▍        | 291/2000 [00:04<00:24, 70.77it/s]     15%|█▍        | 299/2000 [00:04<00:23, 71.38it/s]     15%|█▌        | 307/2000 [00:05<00:23, 73.09it/s]     16%|█▌        | 315/2000 [00:05<00:22, 73.92it/s]     16%|█▌        | 323/2000 [00:05<00:22, 73.29it/s]     17%|█▋        | 331/2000 [00:05<00:22, 73.19it/s]     17%|█▋        | 339/2000 [00:05<00:22, 74.16it/s]     17%|█▋        | 347/2000 [00:05<00:21, 75.15it/s]     18%|█▊        | 356/2000 [00:05<00:21, 76.45it/s]     18%|█▊        | 364/2000 [00:05<00:21, 76.53it/s]     19%|█▊        | 373/2000 [00:05<00:20, 79.78it/s]     19%|█▉        | 382/2000 [00:06<00:19, 81.08it/s]     20%|█▉        | 391/2000 [00:06<00:20, 80.26it/s]     20%|██        | 400/2000 [00:06<00:19, 80.98it/s]     20%|██        | 409/2000 [00:06<00:20, 78.62it/s]     21%|██        | 417/2000 [00:06<00:20, 77.15it/s]     21%|██▏       | 425/2000 [00:06<00:20, 76.34it/s]     22%|██▏       | 433/2000 [00:06<00:20, 75.53it/s]     22%|██▏       | 441/2000 [00:06<00:20, 75.48it/s]     22%|██▎       | 450/2000 [00:06<00:20, 77.08it/s]     23%|██▎       | 458/2000 [00:06<00:19, 77.89it/s]     23%|██▎       | 466/2000 [00:07<00:19, 78.28it/s]     24%|██▍       | 475/2000 [00:07<00:19, 79.90it/s]     24%|██▍       | 484/2000 [00:07<00:18, 80.95it/s]     25%|██▍       | 493/2000 [00:07<00:18, 82.65it/s]     25%|██▌       | 502/2000 [00:07<00:18, 80.95it/s]     26%|██▌       | 511/2000 [00:07<00:17, 83.49it/s]     26%|██▌       | 520/2000 [00:07<00:17, 83.49it/s]     26%|██▋       | 529/2000 [00:07<00:17, 82.60it/s]     27%|██▋       | 538/2000 [00:07<00:17, 82.47it/s]     27%|██▋       | 547/2000 [00:08<00:17, 83.03it/s]     28%|██▊       | 556/2000 [00:08<00:17, 81.94it/s]     28%|██▊       | 565/2000 [00:08<00:17, 83.74it/s]     29%|██▊       | 574/2000 [00:08<00:16, 84.24it/s]     29%|██▉       | 583/2000 [00:08<00:17, 83.20it/s]     30%|██▉       | 592/2000 [00:08<00:17, 81.83it/s]     30%|███       | 601/2000 [00:08<00:16, 82.96it/s]     30%|███       | 610/2000 [00:08<00:17, 81.29it/s]     31%|███       | 619/2000 [00:08<00:17, 81.20it/s]     31%|███▏      | 628/2000 [00:09<00:16, 81.17it/s]     32%|███▏      | 637/2000 [00:09<00:16, 83.09it/s]     32%|███▏      | 646/2000 [00:09<00:16, 83.27it/s]     33%|███▎      | 655/2000 [00:09<00:16, 81.94it/s]     33%|███▎      | 665/2000 [00:09<00:15, 85.50it/s]     34%|███▍      | 675/2000 [00:09<00:15, 88.01it/s]     34%|███▍      | 685/2000 [00:09<00:14, 88.78it/s]     35%|███▍      | 694/2000 [00:09<00:14, 87.79it/s]     35%|███▌      | 703/2000 [00:09<00:14, 88.39it/s]     36%|███▌      | 712/2000 [00:10<00:14, 88.66it/s]     36%|███▌      | 721/2000 [00:10<00:14, 88.17it/s]     36%|███▋      | 730/2000 [00:10<00:14, 88.09it/s]     37%|███▋      | 739/2000 [00:10<00:14, 87.64it/s]     37%|███▋      | 748/2000 [00:10<00:14, 87.92it/s]     38%|███▊      | 757/2000 [00:10<00:14, 87.11it/s]     38%|███▊      | 766/2000 [00:10<00:14, 87.61it/s]     39%|███▉      | 775/2000 [00:10<00:13, 87.75it/s]     39%|███▉      | 784/2000 [00:10<00:13, 88.21it/s]     40%|███▉      | 793/2000 [00:10<00:13, 87.74it/s]     40%|████      | 802/2000 [00:11<00:13, 87.51it/s]     41%|████      | 812/2000 [00:11<00:13, 91.14it/s]     41%|████      | 822/2000 [00:11<00:12, 91.35it/s]     42%|████▏     | 832/2000 [00:11<00:12, 90.18it/s]     42%|████▏     | 842/2000 [00:11<00:12, 89.18it/s]     43%|████▎     | 851/2000 [00:11<00:12, 88.92it/s]     43%|████▎     | 860/2000 [00:11<00:13, 87.54it/s]     43%|████▎     | 869/2000 [00:11<00:13, 86.35it/s]     44%|████▍     | 878/2000 [00:11<00:13, 84.89it/s]     44%|████▍     | 887/2000 [00:12<00:12, 85.68it/s]     45%|████▍     | 896/2000 [00:12<00:12, 85.21it/s]     45%|████▌     | 905/2000 [00:12<00:12, 85.69it/s]     46%|████▌     | 914/2000 [00:12<00:12, 86.76it/s]     46%|████▌     | 923/2000 [00:12<00:12, 86.85it/s]     47%|████▋     | 932/2000 [00:12<00:12, 86.63it/s]     47%|████▋     | 941/2000 [00:12<00:12, 86.91it/s]     48%|████▊     | 950/2000 [00:12<00:12, 86.70it/s]     48%|████▊     | 959/2000 [00:12<00:12, 86.63it/s]     48%|████▊     | 969/2000 [00:12<00:11, 87.93it/s]     49%|████▉     | 979/2000 [00:13<00:11, 89.23it/s]     49%|████▉     | 989/2000 [00:13<00:11, 89.85it/s]     50%|████▉     | 998/2000 [00:13<00:11, 88.06it/s]     50%|█████     | 1007/2000 [00:13<00:11, 87.15it/s]     51%|█████     | 1016/2000 [00:13<00:11, 87.85it/s]     51%|█████▏    | 1026/2000 [00:13<00:10, 90.14it/s]     52%|█████▏    | 1036/2000 [00:13<00:10, 90.11it/s]     52%|█████▏    | 1046/2000 [00:13<00:10, 89.84it/s]     53%|█████▎    | 1056/2000 [00:13<00:10, 90.53it/s]     53%|█████▎    | 1066/2000 [00:14<00:10, 88.72it/s]     54%|█████▍    | 1075/2000 [00:14<00:10, 87.95it/s]     54%|█████▍    | 1084/2000 [00:14<00:10, 87.09it/s]     55%|█████▍    | 1093/2000 [00:14<00:10, 87.16it/s]     55%|█████▌    | 1102/2000 [00:14<00:10, 85.98it/s]     56%|█████▌    | 1111/2000 [00:14<00:10, 86.85it/s]     56%|█████▌    | 1121/2000 [00:14<00:09, 88.42it/s]     57%|█████▋    | 1131/2000 [00:14<00:09, 88.80it/s]     57%|█████▋    | 1141/2000 [00:14<00:09, 90.99it/s]     58%|█████▊    | 1151/2000 [00:14<00:09, 89.78it/s]     58%|█████▊    | 1161/2000 [00:15<00:09, 90.56it/s]     59%|█████▊    | 1171/2000 [00:15<00:09, 89.27it/s]     59%|█████▉    | 1181/2000 [00:15<00:08, 91.09it/s]     60%|█████▉    | 1191/2000 [00:15<00:08, 92.24it/s]     60%|██████    | 1201/2000 [00:15<00:08, 90.65it/s]     61%|██████    | 1211/2000 [00:15<00:08, 92.13it/s]     61%|██████    | 1221/2000 [00:15<00:08, 91.95it/s]     62%|██████▏   | 1231/2000 [00:15<00:08, 90.85it/s]     62%|██████▏   | 1241/2000 [00:15<00:08, 90.45it/s]     63%|██████▎   | 1251/2000 [00:16<00:08, 91.74it/s]     63%|██████▎   | 1261/2000 [00:16<00:08, 91.63it/s]     64%|██████▎   | 1272/2000 [00:16<00:07, 94.83it/s]     64%|██████▍   | 1282/2000 [00:16<00:07, 94.20it/s]     65%|██████▍   | 1292/2000 [00:16<00:07, 94.82it/s]     65%|██████▌   | 1302/2000 [00:16<00:07, 93.05it/s]     66%|██████▌   | 1312/2000 [00:16<00:07, 91.27it/s]     66%|██████▌   | 1322/2000 [00:16<00:07, 89.91it/s]     67%|██████▋   | 1332/2000 [00:16<00:07, 92.00it/s]     67%|██████▋   | 1342/2000 [00:17<00:07, 91.28it/s]     68%|██████▊   | 1352/2000 [00:17<00:07, 91.02it/s]     68%|██████▊   | 1362/2000 [00:17<00:07, 90.92it/s]     69%|██████▊   | 1372/2000 [00:17<00:06, 89.99it/s]     69%|██████▉   | 1382/2000 [00:17<00:06, 89.56it/s]     70%|██████▉   | 1392/2000 [00:17<00:06, 92.18it/s]     70%|███████   | 1402/2000 [00:17<00:06, 91.87it/s]     71%|███████   | 1412/2000 [00:17<00:06, 90.96it/s]     71%|███████   | 1422/2000 [00:17<00:06, 88.14it/s]     72%|███████▏  | 1431/2000 [00:18<00:06, 88.16it/s]     72%|███████▏  | 1440/2000 [00:18<00:06, 88.20it/s]     72%|███████▏  | 1449/2000 [00:18<00:06, 87.16it/s]     73%|███████▎  | 1458/2000 [00:18<00:06, 85.81it/s]     73%|███████▎  | 1468/2000 [00:18<00:06, 88.00it/s]     74%|███████▍  | 1477/2000 [00:18<00:06, 86.37it/s]     74%|███████▍  | 1487/2000 [00:18<00:05, 88.14it/s]     75%|███████▍  | 1496/2000 [00:18<00:05, 88.03it/s]     75%|███████▌  | 1506/2000 [00:18<00:05, 91.43it/s]     76%|███████▌  | 1516/2000 [00:19<00:05, 88.99it/s]     76%|███████▋  | 1526/2000 [00:19<00:05, 89.39it/s]     77%|███████▋  | 1536/2000 [00:19<00:05, 89.59it/s]     77%|███████▋  | 1546/2000 [00:19<00:04, 91.18it/s]     78%|███████▊  | 1556/2000 [00:19<00:04, 91.21it/s]     78%|███████▊  | 1566/2000 [00:19<00:04, 89.24it/s]     79%|███████▉  | 1576/2000 [00:19<00:04, 92.09it/s]     79%|███████▉  | 1586/2000 [00:19<00:04, 92.05it/s]     80%|███████▉  | 1597/2000 [00:19<00:04, 93.97it/s]     80%|████████  | 1607/2000 [00:20<00:04, 90.97it/s]     81%|████████  | 1617/2000 [00:20<00:04, 89.97it/s]     81%|████████▏ | 1627/2000 [00:20<00:04, 90.83it/s]     82%|████████▏ | 1637/2000 [00:20<00:04, 90.52it/s]     82%|████████▏ | 1647/2000 [00:20<00:03, 89.20it/s]     83%|████████▎ | 1656/2000 [00:20<00:03, 88.55it/s]     83%|████████▎ | 1666/2000 [00:20<00:03, 91.03it/s]     84%|████████▍ | 1676/2000 [00:20<00:03, 91.90it/s]     84%|████████▍ | 1686/2000 [00:20<00:03, 92.52it/s]     85%|████████▍ | 1696/2000 [00:21<00:03, 90.20it/s]     85%|████████▌ | 1706/2000 [00:21<00:03, 88.99it/s]     86%|████████▌ | 1715/2000 [00:21<00:03, 88.89it/s]     86%|████████▋ | 1725/2000 [00:21<00:03, 89.98it/s]     87%|████████▋ | 1735/2000 [00:21<00:02, 90.70it/s]     87%|████████▋ | 1745/2000 [00:21<00:02, 90.50it/s]     88%|████████▊ | 1755/2000 [00:21<00:02, 89.55it/s]     88%|████████▊ | 1765/2000 [00:21<00:02, 90.12it/s]     89%|████████▉ | 1775/2000 [00:21<00:02, 91.14it/s]     89%|████████▉ | 1785/2000 [00:21<00:02, 90.17it/s]     90%|████████▉ | 1795/2000 [00:22<00:02, 90.52it/s]     90%|█████████ | 1805/2000 [00:22<00:02, 89.88it/s]     91%|█████████ | 1814/2000 [00:22<00:02, 88.71it/s]     91%|█████████ | 1823/2000 [00:22<00:02, 87.71it/s]     92%|█████████▏| 1833/2000 [00:22<00:01, 88.97it/s]     92%|█████████▏| 1843/2000 [00:22<00:01, 89.40it/s]     93%|█████████▎| 1852/2000 [00:22<00:01, 88.10it/s]     93%|█████████▎| 1861/2000 [00:22<00:01, 87.85it/s]     94%|█████████▎| 1870/2000 [00:22<00:01, 87.40it/s]     94%|█████████▍| 1879/2000 [00:23<00:01, 87.74it/s]     94%|█████████▍| 1888/2000 [00:23<00:01, 88.29it/s]     95%|█████████▍| 1898/2000 [00:23<00:01, 89.95it/s]     95%|█████████▌| 1907/2000 [00:23<00:01, 89.81it/s]     96%|█████████▌| 1916/2000 [00:23<00:00, 87.42it/s]     96%|█████████▋| 1925/2000 [00:23<00:00, 87.27it/s]     97%|█████████▋| 1935/2000 [00:23<00:00, 89.17it/s]     97%|█████████▋| 1945/2000 [00:23<00:00, 88.91it/s]     98%|█████████▊| 1954/2000 [00:23<00:00, 89.15it/s]     98%|█████████▊| 1963/2000 [00:24<00:00, 88.86it/s]     99%|█████████▊| 1973/2000 [00:24<00:00, 90.60it/s]     99%|█████████▉| 1983/2000 [00:24<00:00, 90.45it/s]    100%|█████████▉| 1993/2000 [00:24<00:00, 91.48it/s]    100%|██████████| 2000/2000 [00:24<00:00, 81.92it/s]




.. GENERATED FROM PYTHON SOURCE LINES 803-807

.. code-block:: Python


    sampler = inv_result_fixed_d_sampler.sampler
    az_idata = az.from_emcee(sampler, var_names=labels)








.. GENERATED FROM PYTHON SOURCE LINES 809-812

.. code-block:: Python


    az_idata.get("posterior")






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '►';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '▼';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
    Dimensions:  (chain: 40, draw: 2000)
    Coordinates:
      * chain    (chain) int64 0 1 2 3 4 5 6 7 8 9 ... 30 31 32 33 34 35 36 37 38 39
      * draw     (draw) int64 0 1 2 3 4 5 6 7 ... 1993 1994 1995 1996 1997 1998 1999
    Data variables: (12/17)
        v0       (chain, draw) float64 3.523 3.523 3.47 3.47 ... 3.385 3.385 3.385
        t0       (chain, draw) float64 15.35 15.35 15.25 15.25 ... 20.7 20.7 20.7
        v1       (chain, draw) float64 3.149 3.149 3.193 3.193 ... 3.627 3.627 3.627
        t1       (chain, draw) float64 14.67 14.67 14.67 14.67 ... 8.145 8.145 8.145
        v2       (chain, draw) float64 4.398 4.398 4.293 4.293 ... 4.053 4.053 4.053
        t2       (chain, draw) float64 14.63 14.63 14.83 14.83 ... 22.32 22.32 22.32
        ...       ...
        t5       (chain, draw) float64 15.21 15.21 15.22 15.22 ... 25.92 25.92 25.92
        v6       (chain, draw) float64 4.741 4.741 4.771 4.771 ... 4.511 4.511 4.511
        t6       (chain, draw) float64 15.23 15.23 15.17 15.17 ... 8.778 8.778 8.778
        v7       (chain, draw) float64 4.215 4.215 4.294 4.294 ... 3.954 3.954 3.954
        t7       (chain, draw) float64 14.57 14.57 14.67 14.67 ... 27.0 27.0 27.0
        v8       (chain, draw) float64 4.153 4.153 4.291 4.291 ... 4.629 4.629 4.629
    Attributes:
        created_at:                 2024-04-17T06:36:16.284534
        arviz_version:              0.17.0
        inference_library:          emcee
        inference_library_version:  3.1.4</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-fb055554-f26b-4fa8-b544-df9e00db2bdf' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-fb055554-f26b-4fa8-b544-df9e00db2bdf' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>chain</span>: 40</li><li><span class='xr-has-index'>draw</span>: 2000</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-7a6e03f3-3c43-4126-ae6b-339fa74c6913' class='xr-section-summary-in' type='checkbox'  checked><label for='section-7a6e03f3-3c43-4126-ae6b-339fa74c6913' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>chain</span></div><div class='xr-var-dims'>(chain)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 34 35 36 37 38 39</div><input id='attrs-60284d02-8480-4bf2-939d-0100f4ce17e3' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-60284d02-8480-4bf2-939d-0100f4ce17e3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7bdd04b1-72c0-43f5-bf16-c38ec5d4195c' class='xr-var-data-in' type='checkbox'><label for='data-7bdd04b1-72c0-43f5-bf16-c38ec5d4195c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
           18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,
           36, 37, 38, 39])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>draw</span></div><div class='xr-var-dims'>(draw)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 ... 1996 1997 1998 1999</div><input id='attrs-5cf94305-c492-4259-90cf-8de5475e72fc' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-5cf94305-c492-4259-90cf-8de5475e72fc' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3fbedffa-cbec-4dcb-8337-2a92cee1dca6' class='xr-var-data-in' type='checkbox'><label for='data-3fbedffa-cbec-4dcb-8337-2a92cee1dca6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([   0,    1,    2, ..., 1997, 1998, 1999])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c505dce0-7a6c-47f8-91ef-350621aa805f' class='xr-section-summary-in' type='checkbox'  ><label for='section-c505dce0-7a6c-47f8-91ef-350621aa805f' class='xr-section-summary' >Data variables: <span>(17)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>v0</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.523 3.523 3.47 ... 3.385 3.385</div><input id='attrs-e0a00d9b-3881-4afd-a0dc-d3882b2d0197' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e0a00d9b-3881-4afd-a0dc-d3882b2d0197' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-570c64d0-1c54-462f-95bb-076992b04a55' class='xr-var-data-in' type='checkbox'><label for='data-570c64d0-1c54-462f-95bb-076992b04a55' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[3.52270653, 3.52270653, 3.46967893, ..., 3.35488568, 3.35488568,
            3.35488568],
           [3.01690991, 3.03055891, 3.03055891, ..., 3.37009996, 3.37009996,
            3.37009996],
           [3.6121994 , 3.52606663, 3.52606663, ..., 3.38867105, 3.38867105,
            3.38867105],
           ...,
           [2.74852543, 2.90436918, 3.13450857, ..., 3.38371547, 3.38371547,
            3.38480729],
           [3.04584292, 3.04584292, 3.18957664, ..., 3.38466912, 3.38466912,
            3.38466912],
           [3.42342388, 3.41991243, 3.38603632, ..., 3.38462118, 3.38462118,
            3.38462118]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t0</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.35 15.35 15.25 ... 20.7 20.7</div><input id='attrs-bc0ba5b9-95f1-4157-9ff3-6efd46fc4b66' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-bc0ba5b9-95f1-4157-9ff3-6efd46fc4b66' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f15d3b1c-e362-44e5-8e87-133fde0c0dd1' class='xr-var-data-in' type='checkbox'><label for='data-f15d3b1c-e362-44e5-8e87-133fde0c0dd1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.35375898, 15.35375898, 15.24897595, ..., 13.09490077,
            13.09490077, 13.09490077],
           [15.08232226, 15.07921652, 15.07921652, ..., 10.94612232,
            10.94612232, 10.94612232],
           [14.65910999, 14.71071594, 14.71071594, ...,  9.59227651,
             9.59227651,  9.59227651],
           ...,
           [14.62862332, 14.79382151, 14.7644255 , ..., 15.64480438,
            15.64480438, 15.71877289],
           [15.03496667, 15.03496667, 14.91801488, ..., 14.69015545,
            14.69015545, 14.69015545],
           [15.06501437, 15.06474853, 14.96989732, ..., 20.70291507,
            20.70291507, 20.70291507]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v1</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.149 3.149 3.193 ... 3.627 3.627</div><input id='attrs-230f11c2-7c18-481e-a4f3-fd0c6a0249a1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-230f11c2-7c18-481e-a4f3-fd0c6a0249a1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-77df2f7d-d3cf-4ca9-8f32-64b41926515f' class='xr-var-data-in' type='checkbox'><label for='data-77df2f7d-d3cf-4ca9-8f32-64b41926515f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[3.14859836, 3.14859836, 3.19305483, ..., 3.54176986, 3.54176986,
            3.54176986],
           [3.59866568, 3.60423974, 3.60423974, ..., 3.43936896, 3.43936896,
            3.43936896],
           [3.48707255, 3.52923602, 3.52923602, ..., 3.44494393, 3.44494393,
            3.44494393],
           ...,
           [3.56371302, 3.65903999, 3.70490447, ..., 3.51165592, 3.51165592,
            3.50192195],
           [3.52376027, 3.52376027, 3.61060545, ..., 3.49873078, 3.49873078,
            3.49873078],
           [3.32391744, 3.33187979, 3.38325492, ..., 3.62734387, 3.62734387,
            3.62734387]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t1</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>14.67 14.67 14.67 ... 8.145 8.145</div><input id='attrs-316a42e8-7e39-4cec-9cae-ce4859fffb2a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-316a42e8-7e39-4cec-9cae-ce4859fffb2a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0366e4ca-0859-4f12-8b30-789b8df39211' class='xr-var-data-in' type='checkbox'><label for='data-0366e4ca-0859-4f12-8b30-789b8df39211' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[14.66997156, 14.66997156, 14.6733895 , ..., 16.88253865,
            16.88253865, 16.88253865],
           [15.23729978, 15.23008079, 15.23008079, ..., 10.96943271,
            10.96943271, 10.96943271],
           [14.87956868, 14.8670973 , 14.8670973 , ..., 11.41653542,
            11.41653542, 11.41653542],
           ...,
           [14.87743375, 14.96720581, 15.02687413, ..., 17.28646395,
            17.28646395, 17.34140704],
           [14.9512976 , 14.9512976 , 14.94027694, ..., 16.7532115 ,
            16.7532115 , 16.7532115 ],
           [14.99413297, 14.99452614, 15.11768147, ...,  8.14486049,
             8.14486049,  8.14486049]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v2</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.398 4.398 4.293 ... 4.053 4.053</div><input id='attrs-fc25829a-eab3-4cc1-a4db-7e16d1fcba3c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-fc25829a-eab3-4cc1-a4db-7e16d1fcba3c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-90d990fe-0574-48ae-b25f-c87e11ea80c8' class='xr-var-data-in' type='checkbox'><label for='data-90d990fe-0574-48ae-b25f-c87e11ea80c8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.39831122, 4.39831122, 4.29310042, ..., 4.03190077, 4.03190077,
            4.03190077],
           [3.67761965, 3.68323167, 3.68323167, ..., 3.86730135, 3.86730135,
            3.86730135],
           [4.23496658, 4.19606668, 4.19606668, ..., 3.54981577, 3.54981577,
            3.54981577],
           ...,
           [4.15425234, 4.07975815, 3.98233473, ..., 4.74370782, 4.74370782,
            4.79850227],
           [4.06285467, 4.06285467, 4.0797634 , ..., 4.46630442, 4.46630442,
            4.46630442],
           [4.2293093 , 4.2244851 , 4.18986789, ..., 4.05301902, 4.05301902,
            4.05301902]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t2</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>14.63 14.63 14.83 ... 22.32 22.32</div><input id='attrs-6f749595-fbdd-453c-98a3-d79ca8e0d17c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6f749595-fbdd-453c-98a3-d79ca8e0d17c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a8e2299b-465a-4070-ac13-4b22e19bef66' class='xr-var-data-in' type='checkbox'><label for='data-a8e2299b-465a-4070-ac13-4b22e19bef66' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[14.62875612, 14.62875612, 14.83191617, ...,  5.97580176,
             5.97580176,  5.97580176],
           [15.26548181, 15.2534409 , 15.2534409 , ..., 27.50223515,
            27.50223515, 27.50223515],
           [15.09552291, 15.04268206, 15.04268206, ..., 11.5715796 ,
            11.5715796 , 11.5715796 ],
           ...,
           [15.06604869, 15.06875271, 14.94919728, ..., 17.1918016 ,
            17.1918016 , 16.88431142],
           [15.21574235, 15.21574235, 15.02155268, ..., 18.05843308,
            18.05843308, 18.05843308],
           [14.61518532, 14.62217871, 14.67127399, ..., 22.32447192,
            22.32447192, 22.32447192]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v3</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.481 4.481 4.449 ... 4.298 4.298</div><input id='attrs-23269206-5f4f-487c-8c58-afa2671d9f6b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-23269206-5f4f-487c-8c58-afa2671d9f6b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8158ae3c-270d-4eae-a2df-e53df56f40ef' class='xr-var-data-in' type='checkbox'><label for='data-8158ae3c-270d-4eae-a2df-e53df56f40ef' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.48085512, 4.48085512, 4.44874164, ..., 3.88295436, 3.88295436,
            3.88295436],
           [4.56571822, 4.55901573, 4.55901573, ..., 4.60919625, 4.60919625,
            4.60919625],
           [4.34330764, 4.42448173, 4.42448173, ..., 4.49563465, 4.49563465,
            4.49563465],
           ...,
           [3.72346257, 3.99775215, 4.1497197 , ..., 3.79517048, 3.79517048,
            3.79021121],
           [3.81447154, 3.81447154, 3.92802307, ..., 4.10107882, 4.10107882,
            4.10107882],
           [4.33495789, 4.33532468, 4.35035624, ..., 4.29818902, 4.29818902,
            4.29818902]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t3</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.02 15.02 15.12 ... 14.12 14.12</div><input id='attrs-3ed65ab6-0e38-4dc8-aad9-b20d33d97259' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3ed65ab6-0e38-4dc8-aad9-b20d33d97259' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-833886d8-e1be-46ea-b037-e7e246ca3568' class='xr-var-data-in' type='checkbox'><label for='data-833886d8-e1be-46ea-b037-e7e246ca3568' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.01682633, 15.01682633, 15.11695361, ...,  8.00384661,
             8.00384661,  8.00384661],
           [14.83711811, 14.84041382, 14.84041382, ..., 29.01942736,
            29.01942736, 29.01942736],
           [15.73787077, 15.60412363, 15.60412363, ..., 15.11781779,
            15.11781779, 15.11781779],
           ...,
           [15.41255137, 15.48626859, 15.17118304, ..., 16.47822951,
            16.47822951, 17.2381078 ],
           [14.72821423, 14.72821423, 14.82335393, ...,  9.25600891,
             9.25600891,  9.25600891],
           [15.188952  , 15.18626216, 15.23367864, ..., 14.11937757,
            14.11937757, 14.11937757]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v4</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.178 4.178 4.214 ... 4.992 4.992</div><input id='attrs-d31c41b6-fc18-4018-a1c4-eba1c05550e2' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d31c41b6-fc18-4018-a1c4-eba1c05550e2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4d4c47be-99a9-4de9-9a46-bf1bd6e62d12' class='xr-var-data-in' type='checkbox'><label for='data-4d4c47be-99a9-4de9-9a46-bf1bd6e62d12' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.17837387, 4.17837387, 4.21364638, ..., 4.52923117, 4.52923117,
            4.52923117],
           [4.07293635, 4.08178285, 4.08178285, ..., 4.43737783, 4.43737783,
            4.43737783],
           [4.24614113, 4.27832401, 4.27832401, ..., 4.24866274, 4.24866274,
            4.24866274],
           ...,
           [4.18952532, 4.21425323, 4.1958062 , ..., 4.68260508, 4.68260508,
            4.71571808],
           [4.32121141, 4.32121141, 4.45550505, ..., 4.04022766, 4.04022766,
            4.04022766],
           [4.1904269 , 4.19059751, 4.18108805, ..., 4.99169862, 4.99169862,
            4.99169862]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t4</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.0 15.0 15.01 ... 5.882 5.882</div><input id='attrs-2b26da4f-9db6-4e2b-bfe1-1bca0eefa875' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2b26da4f-9db6-4e2b-bfe1-1bca0eefa875' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-93fba96c-479e-4336-9f8c-f23a563bfd06' class='xr-var-data-in' type='checkbox'><label for='data-93fba96c-479e-4336-9f8c-f23a563bfd06' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.00076004, 15.00076004, 15.01229687, ..., 19.32539342,
            19.32539342, 19.32539342],
           [15.34306176, 15.3295544 , 15.3295544 , ..., 12.78269152,
            12.78269152, 12.78269152],
           [14.87661009, 14.94535342, 14.94535342, ..., 19.97360514,
            19.97360514, 19.97360514],
           ...,
           [14.75170759, 14.90333589, 14.99819388, ..., 13.84152946,
            13.84152946, 14.24889228],
           [14.64535809, 14.64535809, 14.68229113, ..., 17.72800469,
            17.72800469, 17.72800469],
           [15.31581464, 15.31382539, 15.04681378, ...,  5.88154719,
             5.88154719,  5.88154719]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v5</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.992 3.992 4.046 ... 4.45 4.45</div><input id='attrs-9789ebe4-4a7e-435a-94ef-aad38998cdcd' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9789ebe4-4a7e-435a-94ef-aad38998cdcd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-41a1421c-7ffe-4018-8dc3-e37bb5e2c295' class='xr-var-data-in' type='checkbox'><label for='data-41a1421c-7ffe-4018-8dc3-e37bb5e2c295' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[3.99235964, 3.99235964, 4.04553143, ..., 4.33911316, 4.33911316,
            4.33911316],
           [4.21055029, 4.21930177, 4.21930177, ..., 3.95685702, 3.95685702,
            3.95685702],
           [3.96215028, 3.99759251, 3.99759251, ..., 4.02522742, 4.02522742,
            4.02522742],
           ...,
           [4.33468405, 4.42928686, 4.43258532, ..., 4.55745679, 4.55745679,
            4.53561656],
           [4.32300941, 4.32300941, 4.26562409, ..., 4.52611006, 4.52611006,
            4.52611006],
           [4.17327628, 4.1754516 , 4.47155018, ..., 4.44955968, 4.44955968,
            4.44955968]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t5</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.21 15.21 15.22 ... 25.92 25.92</div><input id='attrs-6e39d4cf-c02e-4d04-b1f7-4e4c18ede94c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6e39d4cf-c02e-4d04-b1f7-4e4c18ede94c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0ac17690-9135-40ad-858b-922246421281' class='xr-var-data-in' type='checkbox'><label for='data-0ac17690-9135-40ad-858b-922246421281' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.20556197, 15.20556197, 15.22017408, ..., 18.51973149,
            18.51973149, 18.51973149],
           [15.02575553, 15.03073572, 15.03073572, ..., 19.26811439,
            19.26811439, 19.26811439],
           [14.53704866, 14.6880555 , 14.6880555 , ..., 20.26129561,
            20.26129561, 20.26129561],
           ...,
           [14.98596715, 14.91646958, 14.96246261, ..., 20.45609585,
            20.45609585, 20.40394777],
           [14.9831471 , 14.9831471 , 15.07883412, ..., 20.92533572,
            20.92533572, 20.92533572],
           [14.74245463, 14.74739908, 14.68664004, ..., 25.92284272,
            25.92284272, 25.92284272]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v6</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.741 4.741 4.771 ... 4.511 4.511</div><input id='attrs-93cf963e-83bf-43c6-b703-0240f151f9c8' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-93cf963e-83bf-43c6-b703-0240f151f9c8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-db31de53-6f1b-43fb-b9b8-62478b5b3908' class='xr-var-data-in' type='checkbox'><label for='data-db31de53-6f1b-43fb-b9b8-62478b5b3908' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.74071527, 4.74071527, 4.77076119, ..., 4.44822298, 4.44822298,
            4.44822298],
           [4.34237154, 4.34489416, 4.34489416, ..., 4.74936355, 4.74936355,
            4.74936355],
           [3.89526619, 3.99394837, 3.99394837, ..., 4.88013301, 4.88013301,
            4.88013301],
           ...,
           [4.55486175, 4.62731528, 4.38145563, ..., 4.77305566, 4.77305566,
            4.90038765],
           [3.84023441, 3.84023441, 3.89258229, ..., 4.81020119, 4.81020119,
            4.81020119],
           [4.42563021, 4.42402097, 4.32276838, ..., 4.51140013, 4.51140013,
            4.51140013]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t6</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.23 15.23 15.17 ... 8.778 8.778</div><input id='attrs-b91e8332-1f9e-4d05-b6e0-c181e9babad9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b91e8332-1f9e-4d05-b6e0-c181e9babad9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-db7bfe00-8ce1-44b9-b85f-f534528812b4' class='xr-var-data-in' type='checkbox'><label for='data-db7bfe00-8ce1-44b9-b85f-f534528812b4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.22521046, 15.22521046, 15.17166768, ..., 22.39795071,
            22.39795071, 22.39795071],
           [14.73507565, 14.73403487, 14.73403487, ..., 10.62498247,
            10.62498247, 10.62498247],
           [14.7818781 , 14.72882271, 14.72882271, ..., 28.8045881 ,
            28.8045881 , 28.8045881 ],
           ...,
           [15.05219814, 14.93973591, 14.95833274, ..., 16.8853848 ,
            16.8853848 , 17.20531292],
           [14.56153314, 14.56153314, 14.81110599, ..., 13.73276489,
            13.73276489, 13.73276489],
           [15.60405541, 15.59300552, 15.39612747, ...,  8.77768482,
             8.77768482,  8.77768482]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v7</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.215 4.215 4.294 ... 3.954 3.954</div><input id='attrs-df9f9771-ce16-4e22-bd4e-79b1bfe6414e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-df9f9771-ce16-4e22-bd4e-79b1bfe6414e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7b6aea39-e5a7-473c-b023-33361238d822' class='xr-var-data-in' type='checkbox'><label for='data-7b6aea39-e5a7-473c-b023-33361238d822' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.21490039, 4.21490039, 4.29397805, ..., 3.43676363, 3.43676363,
            3.43676363],
           [4.16226328, 4.16433708, 4.16433708, ..., 3.79826189, 3.79826189,
            3.79826189],
           [4.60340927, 4.43092099, 4.43092099, ..., 4.08471653, 4.08471653,
            4.08471653],
           ...,
           [4.56193915, 4.52922967, 4.34326809, ..., 3.85944735, 3.85944735,
            3.74967418],
           [3.42325087, 3.42325087, 3.6746652 , ..., 4.54805544, 4.54805544,
            4.54805544],
           [4.23208353, 4.23139196, 4.19282704, ..., 3.95401999, 3.95401999,
            3.95401999]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t7</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>14.57 14.57 14.67 ... 27.0 27.0</div><input id='attrs-96b57603-802d-4639-926b-ff197ef9bc7e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-96b57603-802d-4639-926b-ff197ef9bc7e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-902470b9-8892-4170-9b18-babd30471b5c' class='xr-var-data-in' type='checkbox'><label for='data-902470b9-8892-4170-9b18-babd30471b5c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[14.56877687, 14.56877687, 14.67192258, ..., 12.54781826,
            12.54781826, 12.54781826],
           [15.16531082, 15.16598177, 15.16598177, ...,  8.98146558,
             8.98146558,  8.98146558],
           [15.00842713, 14.96990782, 14.96990782, ..., 26.39656774,
            26.39656774, 26.39656774],
           ...,
           [14.74171311, 14.84584891, 15.08603344, ..., 12.19681897,
            12.19681897, 11.89590373],
           [14.63047694, 14.63047694, 14.77699591, ..., 15.04872264,
            15.04872264, 15.04872264],
           [15.18047837, 15.17324338, 15.09855693, ..., 27.00190599,
            27.00190599, 27.00190599]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v8</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.153 4.153 4.291 ... 4.629 4.629</div><input id='attrs-82a7696c-8589-46ad-bfd8-a320bd83fb26' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-82a7696c-8589-46ad-bfd8-a320bd83fb26' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-47ed9ecd-4f5d-4eef-83c3-1aa8e346ac5b' class='xr-var-data-in' type='checkbox'><label for='data-47ed9ecd-4f5d-4eef-83c3-1aa8e346ac5b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.15297213, 4.15297213, 4.29083412, ..., 4.62847825, 4.62847825,
            4.62847825],
           [4.69235364, 4.68894771, 4.68894771, ..., 4.59312641, 4.59312641,
            4.59312641],
           [4.56915204, 4.47375559, 4.47375559, ..., 4.50075937, 4.50075937,
            4.50075937],
           ...,
           [4.55510611, 4.54690874, 4.6022287 , ..., 4.4583008 , 4.4583008 ,
            4.44548313],
           [4.51544982, 4.51544982, 4.54941136, ..., 4.36657309, 4.36657309,
            4.36657309],
           [4.35995122, 4.3637472 , 4.48369791, ..., 4.62929313, 4.62929313,
            4.62929313]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-d1ff6e6c-84b6-405c-8cbb-9ca357b88dc0' class='xr-section-summary-in' type='checkbox'  ><label for='section-d1ff6e6c-84b6-405c-8cbb-9ca357b88dc0' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>chain</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-25bfedcc-5823-4c0f-a27d-eceb629ad0ab' class='xr-index-data-in' type='checkbox'/><label for='index-25bfedcc-5823-4c0f-a27d-eceb629ad0ab' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
           18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,
           36, 37, 38, 39],
          dtype=&#x27;int64&#x27;, name=&#x27;chain&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>draw</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-3ba96eb0-1360-40c0-8dd4-7942768536e1' class='xr-index-data-in' type='checkbox'/><label for='index-3ba96eb0-1360-40c0-8dd4-7942768536e1' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([   0,    1,    2,    3,    4,    5,    6,    7,    8,    9,
           ...
           1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999],
          dtype=&#x27;int64&#x27;, name=&#x27;draw&#x27;, length=2000))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-3a005959-c011-40a1-acd3-8337ca3a53f5' class='xr-section-summary-in' type='checkbox'  checked><label for='section-3a005959-c011-40a1-acd3-8337ca3a53f5' class='xr-section-summary' >Attributes: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>created_at :</span></dt><dd>2024-04-17T06:36:16.284534</dd><dt><span>arviz_version :</span></dt><dd>0.17.0</dd><dt><span>inference_library :</span></dt><dd>emcee</dd><dt><span>inference_library_version :</span></dt><dd>3.1.4</dd></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 814-848

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="initial model for damped solution", color_model="black",
                               forward_func=forward_sw, periods=synth_d_periods, 
                               label_d_pred="d_pred from initial model for damped solution", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=true_model, label_model="true model", color_model="orange",
                        forward_func=forward_sw, periods=synth_d_periods, 
                        label_d_pred="d_pred from true model", color_d_pred="orange", axes=axes)

    # plot the model and d_pred for damped solution, and d_obs
    plot_model_and_data(model=inv_result_optimiser.model, label_model="damped solution", color_model="green",
                        forward_func=forward_sw, periods=synth_d_periods,
                        label_d_pred="d_pred from damped solution", color_d_pred="green", axes=axes);

    # plot randomly selected samples and data predictions from samples
    flat_samples = sampler.get_chain(discard=500, thin=500, flat=True)
    rand_indices = np.random.randint(len(flat_samples), size=100)
    for idx in rand_indices:
        sample = flat_samples[idx]
        label_model = "sample models" if idx == 0 else None
        label_d_pred = "d_pred from samples" if idx == 0 else None
        plot_model_and_data(model=sample, label_model=label_model, color_model="gray",
                            forward_func=forward_sw, periods=synth_d_periods,
                            label_d_pred=label_d_pred, color_d_pred="gray", axes=axes, light_thin=True)

    # plot d_obs
    plot_data(d_obs, synth_d_periods, ax=axes[1], scatter=True, color="red", s=20, label="d_obs")

    axes[0].set_ylim(170)
    axes[0].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46))
    axes[1].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46));




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_007.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_007.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f82502c5300>



.. GENERATED FROM PYTHON SOURCE LINES 850-866

.. code-block:: Python


    axes = az.plot_trace(
        az_idata, 
        backend_kwargs={"constrained_layout":True},
        figsize=(10,20)
    )

    for i, axes_pair in enumerate(axes):
        ax1 = axes_pair[0]
        ax2 = axes_pair[1]
        ax1.axvline(true_model[i], linestyle='dotted', color='red')
        ax1.set_xlabel("parameter value")
        ax1.set_ylabel("density value")
        ax2.set_xlabel("number of iterations")
        ax2.set_ylabel("parameter value")




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_008.png
   :alt: v0, v0, t0, t0, v1, v1, t1, t1, v2, v2, t2, t2, v3, v3, t3, t3, v4, v4, t4, t4, v5, v5, t5, t5, v6, v6, t6, t6, v7, v7, t7, t7, v8, v8
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_008.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 871-885

**More steps?**

Due to time restrictions, we have only run 2_000 steps above, which
might be enough for illustration purpose and sanity check, but are not
enough for an actual inversion.

On a seperate experiment, we ran 200_000 steps instead and produced the
following samples plot.

.. figure:: illustrations/emcee_200_000_iterations.png
   :alt: Fixed-dimensional sampling results with 200_000 steps

   Fixed-dimensional sampling results with 200_000 steps


.. GENERATED FROM PYTHON SOURCE LINES 888-891

Trans-dimensional sampling
~~~~~~~~~~~~~~~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 894-896

**Prepare utilities for trans-dimensional sampling**


.. GENERATED FROM PYTHON SOURCE LINES 896-905

.. code-block:: Python


    def forward_for_bayesbay(state):
        vs = state["voronoi"]["vs"]
        voronoi_sites = state["voronoi"]["discretization"]
        depths = (voronoi_sites[:-1] + voronoi_sites[1:]) / 2
        thicknesses = depths - np.insert(depths[:-1], 0, 0)
        model = form_layercake_model(thicknesses, vs)
        return forward_sw(model, synth_d_periods)








.. GENERATED FROM PYTHON SOURCE LINES 907-912

.. code-block:: Python


    targets = [bayesbay.Target("rayleigh", d_obs, covariance_mat_inv=1/noise_level**2)]
    fwd_funcs = [forward_for_bayesbay]
    my_log_likelihood = bayesbay.LogLikelihood(targets, fwd_funcs)








.. GENERATED FROM PYTHON SOURCE LINES 914-937

.. code-block:: Python


    param_vs = bayesbay.prior.UniformPrior(
        name="vs", 
        vmin=[2.7, 3.2, 3.75], 
        vmax=[4, 4.75, 5], 
        position=[0, 40, 80], 
        perturb_std=0.15
    )

    def param_vs_initialize(param, positions): 
        vmin, vmax = param.get_vmin_vmax(positions)
        sorted_vals = np.sort(np.random.uniform(vmin, vmax, positions.size))
        for i in range (len(sorted_vals)):
            val = sorted_vals[i]
            vmin_i = vmin if np.isscalar(vmin) else vmin[i]
            vmax_i = vmax if np.isscalar(vmax) else vmax[i]
            if val < vmin_i or val > vmax_i:
                if val > vmax_i: sorted_vals[i] = vmax_i
                if val < vmin_i: sorted_vals[i] = vmin_i
        return sorted_vals

    param_vs.set_custom_initialize(param_vs_initialize)








.. GENERATED FROM PYTHON SOURCE LINES 939-954

.. code-block:: Python


    parameterization = bayesbay.parameterization.Parameterization(
        bayesbay.discretization.Voronoi1D(
            name="voronoi", 
            vmin=0, 
            vmax=150, 
            perturb_std=10, 
            n_dimensions=None, 
            n_dimensions_min=4, 
            n_dimensions_max=15, 
            parameters=[param_vs], 
        )
    )
    my_perturbation_funcs = parameterization.perturbation_functions








.. GENERATED FROM PYTHON SOURCE LINES 956-962

.. code-block:: Python


    n_chains=12
    walkers_start = []
    for i in range(n_chains):
        walkers_start.append(parameterization.initialize())








.. GENERATED FROM PYTHON SOURCE LINES 967-969

**Define ``InversionOptions``**


.. GENERATED FROM PYTHON SOURCE LINES 969-983

.. code-block:: Python


    inv_options_trans_d_sampling = cofi.InversionOptions()
    inv_options_trans_d_sampling.set_tool("bayesbay")
    inv_options_trans_d_sampling.set_params(
        walkers_starting_states=walkers_start,
        perturbation_funcs=my_perturbation_funcs,
        log_like_ratio_func=my_log_likelihood,
        n_chains=n_chains, 
        n_iterations=3_000, 
        burnin_iterations=1_000,
        verbose=False, 
        save_every=200, 
    )








.. GENERATED FROM PYTHON SOURCE LINES 988-990

**Define ``Inversion`` and run**


.. GENERATED FROM PYTHON SOURCE LINES 990-994

.. code-block:: Python


    inversion_trans_d_sampler = cofi.Inversion(sw_problem, inv_options_trans_d_sampling)
    inv_result_trans_d_sampler = inversion_trans_d_sampler.run()








.. GENERATED FROM PYTHON SOURCE LINES 996-1003

.. code-block:: Python


    inverted_models = inv_result_trans_d_sampler.models
    samples = []
    for v, vs in zip(inverted_models["voronoi.discretization"], inverted_models["voronoi.vs"]):
        sample = form_voronoi_model(v, vs)
        samples.append(voronoi_to_layercake(sample))








.. GENERATED FROM PYTHON SOURCE LINES 1005-1036

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="initial model for damped solution", color_model="black",
                               forward_func=forward_sw, periods=synth_d_periods, 
                               label_d_pred="d_pred from initial model for damped solution", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=true_model, label_model="true model", color_model="orange",
                        forward_func=forward_sw, periods=synth_d_periods, 
                        label_d_pred="d_pred from true model", color_d_pred="orange", axes=axes)

    # plot the model and d_pred for damped solution, and d_obs
    plot_model_and_data(model=inv_result_optimiser.model, label_model="damped solution", color_model="green",
                        forward_func=forward_sw, periods=synth_d_periods,
                        label_d_pred="d_pred from damped solution", color_d_pred="green", axes=axes);

    # plot randomly selected samples and data predictions from samples
    for i, sample in enumerate(samples):
        label_model = "sample models" if i == 0 else None
        label_d_pred = "d_pred from samples" if i == 0 else None
        plot_model_and_data(model=sample, label_model=label_model, color_model="gray",
                            forward_func=forward_sw, periods=synth_d_periods,
                            label_d_pred=label_d_pred, color_d_pred="gray", axes=axes, light_thin=True)

    # plot d_obs
    plot_data(d_obs, synth_d_periods, ax=axes[1], scatter=True, color="red", s=20, label="d_obs")

    axes[0].set_ylim(170)
    axes[0].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46))
    axes[1].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46));




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_009.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_009.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f842413b5b0>



.. GENERATED FROM PYTHON SOURCE LINES 1041-1044

Field data example
------------------


.. GENERATED FROM PYTHON SOURCE LINES 1047-1050

Read data
~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 1053-1055

**Rayleigh observations**


.. GENERATED FROM PYTHON SOURCE LINES 1055-1070

.. code-block:: Python


    file_surf_data = "../../data/sw_rf_joint/data/SURF/nnall.dsp"

    with open(file_surf_data, "r") as file:
        lines = file.readlines()
        surf_data = []
        for line in lines:
            row = line.strip().split()
            if "C" in row:
                surf_data.append([float(e) for e in row[5:8]])

    field_d = np.array(surf_data)
    field_d_periods = field_d[:,0]
    field_d_obs = field_d[:,1]








.. GENERATED FROM PYTHON SOURCE LINES 1072-1077

.. code-block:: Python


    ax = plot_data(field_d_obs, field_d_periods, color="brown", s=5, scatter=True,
                 label="d_obs")
    ax.legend();




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_010.png
   :alt: data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_010.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f83f152e290>



.. GENERATED FROM PYTHON SOURCE LINES 1082-1084

**Reference good model**


.. GENERATED FROM PYTHON SOURCE LINES 1084-1097

.. code-block:: Python


    file_end_mod = "../../data/sw_rf_joint/data/SURF/end.mod"

    with open(file_end_mod, "r") as file:
        lines = file.readlines()
        ref_good_model = []
        for line in lines[12:]:
            row = line.strip().split()
            ref_good_model.append([float(row[0]), float(row[2])])

    ref_good_model = np.array(ref_good_model)
    ref_good_model = form_layercake_model(ref_good_model[:-1,0], ref_good_model[:,1])








.. GENERATED FROM PYTHON SOURCE LINES 1099-1103

.. code-block:: Python


    _, ax = plt.subplots(figsize=(4,6))
    plot_model(ref_good_model, ax=ax, alpha=1);




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_011.png
   :alt: model
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_011.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <Axes: title={'center': 'model'}, xlabel='Vs (km/s)', ylabel='Depth (km)'>



.. GENERATED FROM PYTHON SOURCE LINES 1108-1111

Modified forward utility
~~~~~~~~~~~~~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 1111-1126

.. code-block:: Python


    def forward_sw_interp(model, periods=field_d_periods):
        pysurf_periods = np.logspace(
            np.log(np.min(periods)), 
            np.log(np.max(periods+1)), 
            60,
            base=np.e, 
        )
        pysurf_dpred = forward_sw(model, pysurf_periods)
        interp_func = scipy.interpolate.interp1d(pysurf_periods, 
                                                 pysurf_dpred, 
                                                 fill_value="extrapolate")
        dpred = interp_func(periods)
        return dpred








.. GENERATED FROM PYTHON SOURCE LINES 1131-1134

Optimisation
~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 1134-1141

.. code-block:: Python


    n_dims = 29

    init_thicknesses = np.ones((n_dims//2,)) * 10
    init_vs = np.ones((n_dims//2+1,)) * 4.0
    init_model = form_layercake_model(init_thicknesses, init_vs)








.. GENERATED FROM PYTHON SOURCE LINES 1143-1150

.. code-block:: Python


    my_reg = cofi.utils.QuadraticReg(
        weighting_matrix="damping", 
        model_shape=(n_dims,), 
        reference_model=init_model
    )








.. GENERATED FROM PYTHON SOURCE LINES 1155-1158

Optimisation with no damping
^^^^^^^^^^^^^^^^^^^^^^^^^^^^


.. GENERATED FROM PYTHON SOURCE LINES 1158-1173

.. code-block:: Python


    lamda = 0

    kwargs = {
        "fwd": forward_sw_interp,
        "periods": field_d_periods, 
        "d_obs": field_d_obs, 
        "lamda": lamda, 
    }
    sw_field_problem_no_reg = cofi.BaseProblem()
    sw_field_problem_no_reg.set_objective(my_objective, kwargs=kwargs)
    sw_field_problem_no_reg.set_gradient(my_objective_gradient, kwargs=kwargs)
    sw_field_problem_no_reg.set_hessian(my_objective_hessian, kwargs=kwargs)
    sw_field_problem_no_reg.set_initial_model(init_model)








.. GENERATED FROM PYTHON SOURCE LINES 1178-1180

**Define ``Inversion`` and run**


.. GENERATED FROM PYTHON SOURCE LINES 1180-1184

.. code-block:: Python


    inv_sw_field_problem_no_reg = cofi.Inversion(sw_field_problem_no_reg, inv_options_optimiser)
    inv_result_sw_field_no_reg = inv_sw_field_problem_no_reg.run()








.. GENERATED FROM PYTHON SOURCE LINES 1189-1191

**Plot results**


.. GENERATED FROM PYTHON SOURCE LINES 1191-1199

.. code-block:: Python


    field_d_periods_logspace = np.logspace(
        np.log(np.min(field_d_periods)), 
        np.log(np.max(field_d_periods+1)), 
        60, 
        base=np.e, 
    )








.. GENERATED FROM PYTHON SOURCE LINES 1201-1225

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="starting model", color_model="black",
                               forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                               label_d_pred="d_pred from starting model", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=ref_good_model, label_model="reference good model", color_model="red",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                        label_d_pred="d_pred from reference good model", color_d_pred="red", axes=axes)

    # plot the model and d_pred for inverted model, and d_obs
    plot_model_and_data(model=inv_result_sw_field_no_reg.model, 
                        label_model="inverted model from field data", color_model="purple",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace,
                        label_d_pred="d_pred from inverted model", color_d_pred="purple", axes=axes)

    # plot d_obs
    plot_data(field_d_obs, field_d_periods, ax=axes[1], scatter=True, color="orange", s=8, label="d_obs")

    axes[0].set_ylim(100, 0)
    axes[0].legend(loc="lower center", bbox_to_anchor=(0.5, -0.4))
    axes[1].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46));




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_012.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_012.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f8423f542e0>



.. GENERATED FROM PYTHON SOURCE LINES 1230-1235

Optimal damping
^^^^^^^^^^^^^^^

Again, we would like to find a good regularisation factor.


.. GENERATED FROM PYTHON SOURCE LINES 1235-1270

.. code-block:: Python


    lambdas = np.logspace(-6, 6, 15)

    my_lcurve_problems = []
    for lamb in lambdas:
        my_problem = cofi.BaseProblem()
        kwargs = {
            "fwd": forward_sw_interp,
            "periods": field_d_periods, 
            "d_obs": field_d_obs, 
            "lamda": lamb, 
        }
        my_problem.set_objective(my_objective, kwargs=kwargs)
        my_problem.set_gradient(my_objective_gradient, kwargs=kwargs)
        my_problem.set_hessian(my_objective_hessian, kwargs=kwargs)
        my_problem.set_initial_model(init_model)
        my_lcurve_problems.append(my_problem)

    def my_callback(inv_result, i):
        m = inv_result.model
        res_norm = np.linalg.norm(forward_sw_interp(m, field_d_periods) - field_d_obs)
        reg_norm = np.sqrt(my_reg(m))
        print(f"Finished inversion with lambda={lambdas[i]}: {res_norm}, {reg_norm}")
        return res_norm, reg_norm

    my_inversion_pool = cofi.utils.InversionPool(
        list_of_inv_problems=my_lcurve_problems,
        list_of_inv_options=inv_options_optimiser,
        callback=my_callback,
        parallel=False
    )
    all_res, all_cb_returns = my_inversion_pool.run()

    l_curve_points = list(zip(*all_cb_returns))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Finished inversion with lambda=1e-06: 1.9540941311396671, 26.76038061981958
    Finished inversion with lambda=7.196856730011514e-06: 1.9550864034073558, 22.207089085958135
    Finished inversion with lambda=5.1794746792312125e-05: 1.9672756794905297, 10.950500473754719
    Finished inversion with lambda=0.0003727593720314938: 1.9699341235211631, 7.6340413525597866
    Finished inversion with lambda=0.0026826957952797246: 1.9782390541679031, 4.552509100476192
    Finished inversion with lambda=0.019306977288832496: 2.0050549438091747, 2.3442273803041136
    Finished inversion with lambda=0.1389495494373136: 2.0393073369018655, 1.6477206878151607
    Finished inversion with lambda=1.0: 2.112939266124699, 1.3870331002558811
    Finished inversion with lambda=7.196856730011514: 2.7878693578372693, 0.9907601514482579
    Finished inversion with lambda=51.79474679231202: 4.890126438918003, 0.34475194170977674
    Finished inversion with lambda=372.7593720314938: 5.957321022746526, 0.06129962536156985
    Finished inversion with lambda=2682.6957952797275: 6.160087164630214, 0.008874921981364005
    Finished inversion with lambda=19306.977288832455: 6.189744923132511, 0.001240946449950785
    Finished inversion with lambda=138949.5494373136: 6.193898179384247, 0.0001725411516554573
    Finished inversion with lambda=1000000.0: 6.194457488485488, 2.3974628324356084e-05




.. GENERATED FROM PYTHON SOURCE LINES 1272-1276

.. code-block:: Python


    # print all the lambdas
    lambdas





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array([1.00000000e-06, 7.19685673e-06, 5.17947468e-05, 3.72759372e-04,
           2.68269580e-03, 1.93069773e-02, 1.38949549e-01, 1.00000000e+00,
           7.19685673e+00, 5.17947468e+01, 3.72759372e+02, 2.68269580e+03,
           1.93069773e+04, 1.38949549e+05, 1.00000000e+06])



.. GENERATED FROM PYTHON SOURCE LINES 1278-1287

.. code-block:: Python


    # plot the L-curve
    res_norm, reg_norm = l_curve_points
    plt.plot(reg_norm, res_norm, '.-')
    plt.xlabel(r'Norm of regularization term $||Wm||_2$')
    plt.ylabel(r'Norm of residual $||g(m)-d||_2$')
    for i in range(0, len(lambdas), 2):
        plt.annotate(f'{lambdas[i]:.1e}', (reg_norm[i], res_norm[i]), fontsize=8)




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_013.png
   :alt: 1D rayleigh wave phase velocity inversion
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_013.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 1292-1295

Optimisation with damping
^^^^^^^^^^^^^^^^^^^^^^^^^


.. GENERATED FROM PYTHON SOURCE LINES 1295-1310

.. code-block:: Python


    lamda = 0.14

    kwargs = {
        "fwd": forward_sw_interp,
        "periods": field_d_periods, 
        "d_obs": field_d_obs, 
        "lamda": lamda, 
    }
    sw_field_problem = cofi.BaseProblem()
    sw_field_problem.set_objective(my_objective, kwargs=kwargs)
    sw_field_problem.set_gradient(my_objective_gradient, kwargs=kwargs)
    sw_field_problem.set_hessian(my_objective_hessian, kwargs=kwargs)
    sw_field_problem.set_initial_model(init_model)








.. GENERATED FROM PYTHON SOURCE LINES 1315-1317

**Define ``Inversion`` and run**


.. GENERATED FROM PYTHON SOURCE LINES 1317-1321

.. code-block:: Python


    inv_sw_field_problem = cofi.Inversion(sw_field_problem, inv_options_optimiser)
    inv_result_sw_field = inv_sw_field_problem.run()








.. GENERATED FROM PYTHON SOURCE LINES 1326-1328

**Plot results**


.. GENERATED FROM PYTHON SOURCE LINES 1328-1352

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="starting model", color_model="black",
                               forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                               label_d_pred="d_pred from starting model", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=ref_good_model, label_model="reference good model", color_model="red",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                        label_d_pred="d_pred from reference good model", color_d_pred="red", axes=axes)

    # plot the model and d_pred for inverted model, and d_obs
    plot_model_and_data(model=inv_result_sw_field.model, 
                        label_model="inverted model from field data", color_model="purple",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace,
                        label_d_pred="d_pred from inverted model", color_d_pred="purple", axes=axes)

    # plot d_obs
    plot_data(field_d_obs, field_d_periods, ax=axes[1], scatter=True, color="orange", s=8, label="d_obs")

    axes[0].set_ylim(100, 0)
    axes[0].legend(loc="lower center", bbox_to_anchor=(0.5, -0.4))
    axes[1].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46));




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_014.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_014.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f8208640520>



.. GENERATED FROM PYTHON SOURCE LINES 1357-1363

Fixed-dimensional sampling
~~~~~~~~~~~~~~~~~~~~~~~~~~

We are going to use the same sets of log prior, and we will rewrite the
log likelihood function to apply on the field data.


.. GENERATED FROM PYTHON SOURCE LINES 1363-1379

.. code-block:: Python


    thick_min = 3
    thick_max = 10
    vs_min = 2
    vs_max = 5.5

    def my_log_prior(model):
        thicknesses, vs = split_layercake_model(model)
        thicknesses_out_of_bounds = (thicknesses < thick_min) | (thicknesses > thick_max)
        vs_out_of_bounds = (vs < vs_min) | (vs > vs_max)
        if np.any(thicknesses_out_of_bounds) or np.any(vs_out_of_bounds):
            return float("-inf")
        log_prior = - np.log(thick_max - thick_min) * len(thicknesses) \
                    - np.log(vs_max - vs_min) * len(vs)
        return log_prior








.. GENERATED FROM PYTHON SOURCE LINES 1381-1389

.. code-block:: Python


    # estimate the data noise
    d_pred_from_optimiser = forward_sw_interp(inv_result_sw_field.model, field_d_periods)
    noise_level = np.std(field_d_obs - d_pred_from_optimiser)
    Cdinv = np.eye(len(field_d_obs))/(noise_level**2)

    print(f"Estimated noise level: {noise_level}")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Estimated noise level: 0.10587785944399027




.. GENERATED FROM PYTHON SOURCE LINES 1391-1400

.. code-block:: Python


    def my_log_likelihood(model):
        try:
            d_pred = forward_sw_interp(model, field_d_periods)
        except:
            return float("-inf")
        residual = field_d_obs - d_pred
        return -0.5 * residual @ (Cdinv @ residual).T








.. GENERATED FROM PYTHON SOURCE LINES 1402-1409

.. code-block:: Python


    n_walkers = 60

    my_walkers_start = np.ones((n_walkers, n_dims)) * inv_result_sw_field.model
    for i in range(n_walkers):
        my_walkers_start[i,:] += np.random.normal(0, 0.3, n_dims)








.. GENERATED FROM PYTHON SOURCE LINES 1411-1415

.. code-block:: Python


    sw_field_problem.set_log_prior(my_log_prior)
    sw_field_problem.set_log_likelihood(my_log_likelihood)








.. GENERATED FROM PYTHON SOURCE LINES 1420-1422

**Define ``InversionOptions``**


.. GENERATED FROM PYTHON SOURCE LINES 1422-1433

.. code-block:: Python


    inv_options_fixed_d_sampling = cofi.InversionOptions()
    inv_options_fixed_d_sampling.set_tool("emcee")
    inv_options_fixed_d_sampling.set_params(
        nwalkers=n_walkers,
        nsteps=20_000,
        initial_state=my_walkers_start,
        skip_initial_state_check=True,
        progress=True
    )








.. GENERATED FROM PYTHON SOURCE LINES 1438-1441

Sample the posterior
^^^^^^^^^^^^^^^^^^^^


.. GENERATED FROM PYTHON SOURCE LINES 1441-1446

.. code-block:: Python


    inversion_fixed_d_sampler_field = cofi.Inversion(sw_field_problem,
                                                     inv_options_fixed_d_sampling)
    inv_result_fixed_d_sampler_field = inversion_fixed_d_sampler_field.run()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/20000 [00:00<?, ?it/s]      0%|          | 90/20000 [00:00<00:22, 897.52it/s]      1%|          | 180/20000 [00:00<00:22, 897.02it/s]      1%|▏         | 271/20000 [00:00<00:21, 898.52it/s]      2%|▏         | 362/20000 [00:00<00:21, 899.49it/s]      2%|▏         | 453/20000 [00:00<00:21, 900.24it/s]      3%|▎         | 544/20000 [00:00<00:21, 900.46it/s]      3%|▎         | 635/20000 [00:00<00:21, 900.16it/s]      4%|▎         | 726/20000 [00:00<00:21, 899.79it/s]      4%|▍         | 817/20000 [00:00<00:21, 900.26it/s]      5%|▍         | 908/20000 [00:01<00:21, 897.70it/s]      5%|▍         | 999/20000 [00:01<00:21, 898.73it/s]      5%|▌         | 1089/20000 [00:01<00:21, 899.05it/s]      6%|▌         | 1179/20000 [00:01<00:20, 899.32it/s]      6%|▋         | 1270/20000 [00:01<00:20, 900.27it/s]      7%|▋         | 1361/20000 [00:01<00:20, 900.25it/s]      7%|▋         | 1452/20000 [00:01<00:20, 899.21it/s]      8%|▊         | 1543/20000 [00:01<00:20, 901.01it/s]      8%|▊         | 1634/20000 [00:01<00:20, 900.59it/s]      9%|▊         | 1725/20000 [00:01<00:20, 893.50it/s]      9%|▉         | 1815/20000 [00:02<00:20, 894.08it/s]     10%|▉         | 1906/20000 [00:02<00:20, 897.99it/s]     10%|▉         | 1997/20000 [00:02<00:20, 899.72it/s]     10%|█         | 2088/20000 [00:02<00:19, 900.99it/s]     11%|█         | 2179/20000 [00:02<00:19, 900.74it/s]     11%|█▏        | 2270/20000 [00:02<00:19, 902.66it/s]     12%|█▏        | 2361/20000 [00:02<00:19, 903.68it/s]     12%|█▏        | 2452/20000 [00:02<00:19, 899.46it/s]     13%|█▎        | 2543/20000 [00:02<00:19, 900.75it/s]     13%|█▎        | 2634/20000 [00:02<00:19, 898.65it/s]     14%|█▎        | 2724/20000 [00:03<00:19, 892.87it/s]     14%|█▍        | 2814/20000 [00:03<00:19, 894.01it/s]     15%|█▍        | 2905/20000 [00:03<00:19, 896.36it/s]     15%|█▍        | 2996/20000 [00:03<00:18, 897.53it/s]     15%|█▌        | 3087/20000 [00:03<00:18, 899.39it/s]     16%|█▌        | 3177/20000 [00:03<00:18, 898.92it/s]     16%|█▋        | 3267/20000 [00:03<00:18, 899.07it/s]     17%|█▋        | 3358/20000 [00:03<00:18, 899.95it/s]     17%|█▋        | 3449/20000 [00:03<00:18, 900.90it/s]     18%|█▊        | 3540/20000 [00:03<00:18, 899.60it/s]     18%|█▊        | 3630/20000 [00:04<00:18, 896.58it/s]     19%|█▊        | 3720/20000 [00:04<00:18, 896.32it/s]     19%|█▉        | 3810/20000 [00:04<00:18, 896.97it/s]     20%|█▉        | 3900/20000 [00:04<00:17, 897.74it/s]     20%|█▉        | 3990/20000 [00:04<00:17, 896.21it/s]     20%|██        | 4081/20000 [00:04<00:17, 897.80it/s]     21%|██        | 4171/20000 [00:04<00:17, 898.07it/s]     21%|██▏       | 4261/20000 [00:04<00:17, 886.12it/s]     22%|██▏       | 4351/20000 [00:04<00:17, 889.65it/s]     22%|██▏       | 4441/20000 [00:04<00:17, 890.60it/s]     23%|██▎       | 4531/20000 [00:05<00:17, 892.98it/s]     23%|██▎       | 4622/20000 [00:05<00:17, 896.06it/s]     24%|██▎       | 4712/20000 [00:05<00:17, 894.63it/s]     24%|██▍       | 4802/20000 [00:05<00:16, 895.81it/s]     24%|██▍       | 4893/20000 [00:05<00:16, 897.80it/s]     25%|██▍       | 4984/20000 [00:05<00:16, 898.86it/s]     25%|██▌       | 5074/20000 [00:05<00:16, 899.08it/s]     26%|██▌       | 5164/20000 [00:05<00:16, 898.96it/s]     26%|██▋       | 5254/20000 [00:05<00:16, 896.23it/s]     27%|██▋       | 5344/20000 [00:05<00:16, 896.20it/s]     27%|██▋       | 5434/20000 [00:06<00:16, 897.09it/s]     28%|██▊       | 5525/20000 [00:06<00:16, 898.22it/s]     28%|██▊       | 5616/20000 [00:06<00:16, 898.99it/s]     29%|██▊       | 5707/20000 [00:06<00:15, 900.44it/s]     29%|██▉       | 5798/20000 [00:06<00:15, 898.39it/s]     29%|██▉       | 5888/20000 [00:06<00:15, 898.42it/s]     30%|██▉       | 5978/20000 [00:06<00:15, 897.99it/s]     30%|███       | 6068/20000 [00:06<00:15, 897.52it/s]     31%|███       | 6158/20000 [00:06<00:15, 890.34it/s]     31%|███       | 6248/20000 [00:06<00:15, 892.29it/s]     32%|███▏      | 6338/20000 [00:07<00:15, 893.72it/s]     32%|███▏      | 6429/20000 [00:07<00:15, 896.10it/s]     33%|███▎      | 6519/20000 [00:07<00:15, 896.26it/s]     33%|███▎      | 6609/20000 [00:07<00:14, 897.12it/s]     33%|███▎      | 6699/20000 [00:07<00:14, 897.52it/s]     34%|███▍      | 6789/20000 [00:07<00:14, 898.23it/s]     34%|███▍      | 6879/20000 [00:07<00:14, 896.36it/s]     35%|███▍      | 6969/20000 [00:07<00:14, 896.21it/s]     35%|███▌      | 7059/20000 [00:07<00:14, 892.15it/s]     36%|███▌      | 7149/20000 [00:07<00:14, 892.39it/s]     36%|███▌      | 7239/20000 [00:08<00:14, 889.44it/s]     37%|███▋      | 7329/20000 [00:08<00:14, 889.99it/s]     37%|███▋      | 7419/20000 [00:08<00:14, 888.69it/s]     38%|███▊      | 7508/20000 [00:08<00:14, 887.69it/s]     38%|███▊      | 7598/20000 [00:08<00:13, 889.78it/s]     38%|███▊      | 7688/20000 [00:08<00:13, 891.09it/s]     39%|███▉      | 7778/20000 [00:08<00:13, 892.08it/s]     39%|███▉      | 7868/20000 [00:08<00:13, 892.31it/s]     40%|███▉      | 7958/20000 [00:08<00:13, 887.99it/s]     40%|████      | 8047/20000 [00:08<00:13, 886.31it/s]     41%|████      | 8137/20000 [00:09<00:13, 889.21it/s]     41%|████      | 8228/20000 [00:09<00:13, 892.75it/s]     42%|████▏     | 8319/20000 [00:09<00:13, 897.55it/s]     42%|████▏     | 8410/20000 [00:09<00:12, 898.69it/s]     43%|████▎     | 8501/20000 [00:09<00:12, 900.08it/s]     43%|████▎     | 8592/20000 [00:09<00:12, 898.81it/s]     43%|████▎     | 8682/20000 [00:09<00:12, 897.73it/s]     44%|████▍     | 8772/20000 [00:09<00:12, 888.61it/s]     44%|████▍     | 8862/20000 [00:09<00:12, 891.39it/s]     45%|████▍     | 8952/20000 [00:09<00:12, 893.01it/s]     45%|████▌     | 9043/20000 [00:10<00:12, 895.85it/s]     46%|████▌     | 9134/20000 [00:10<00:12, 897.79it/s]     46%|████▌     | 9224/20000 [00:10<00:11, 898.24it/s]     47%|████▋     | 9314/20000 [00:10<00:12, 888.81it/s]     47%|████▋     | 9405/20000 [00:10<00:11, 892.22it/s]     47%|████▋     | 9496/20000 [00:10<00:11, 895.76it/s]     48%|████▊     | 9587/20000 [00:10<00:11, 898.95it/s]     48%|████▊     | 9678/20000 [00:10<00:11, 900.90it/s]     49%|████▉     | 9769/20000 [00:10<00:11, 900.18it/s]     49%|████▉     | 9860/20000 [00:10<00:11, 901.36it/s]     50%|████▉     | 9951/20000 [00:11<00:11, 898.44it/s]     50%|█████     | 10041/20000 [00:11<00:11, 897.86it/s]     51%|█████     | 10132/20000 [00:11<00:10, 898.70it/s]     51%|█████     | 10222/20000 [00:11<00:10, 898.76it/s]     52%|█████▏    | 10313/20000 [00:11<00:10, 899.19it/s]     52%|█████▏    | 10404/20000 [00:11<00:10, 900.56it/s]     52%|█████▏    | 10495/20000 [00:11<00:10, 900.52it/s]     53%|█████▎    | 10586/20000 [00:11<00:10, 900.71it/s]     53%|█████▎    | 10677/20000 [00:11<00:10, 896.51it/s]     54%|█████▍    | 10767/20000 [00:12<00:10, 896.44it/s]     54%|█████▍    | 10857/20000 [00:12<00:10, 895.64it/s]     55%|█████▍    | 10948/20000 [00:12<00:10, 897.05it/s]     55%|█████▌    | 11039/20000 [00:12<00:09, 898.07it/s]     56%|█████▌    | 11129/20000 [00:12<00:09, 898.10it/s]     56%|█████▌    | 11220/20000 [00:12<00:09, 899.47it/s]     57%|█████▋    | 11311/20000 [00:12<00:09, 899.77it/s]     57%|█████▋    | 11402/20000 [00:12<00:09, 900.52it/s]     57%|█████▋    | 11493/20000 [00:12<00:09, 899.78it/s]     58%|█████▊    | 11583/20000 [00:12<00:09, 893.01it/s]     58%|█████▊    | 11673/20000 [00:13<00:09, 893.27it/s]     59%|█████▉    | 11763/20000 [00:13<00:09, 892.30it/s]     59%|█████▉    | 11853/20000 [00:13<00:09, 893.28it/s]     60%|█████▉    | 11943/20000 [00:13<00:09, 893.65it/s]     60%|██████    | 12033/20000 [00:13<00:08, 895.33it/s]     61%|██████    | 12123/20000 [00:13<00:08, 893.75it/s]     61%|██████    | 12213/20000 [00:13<00:08, 893.71it/s]     62%|██████▏   | 12303/20000 [00:13<00:08, 893.30it/s]     62%|██████▏   | 12393/20000 [00:13<00:08, 893.15it/s]     62%|██████▏   | 12483/20000 [00:13<00:08, 887.14it/s]     63%|██████▎   | 12574/20000 [00:14<00:08, 891.24it/s]     63%|██████▎   | 12664/20000 [00:14<00:08, 891.08it/s]     64%|██████▍   | 12754/20000 [00:14<00:08, 890.55it/s]     64%|██████▍   | 12844/20000 [00:14<00:08, 891.26it/s]     65%|██████▍   | 12935/20000 [00:14<00:07, 894.34it/s]     65%|██████▌   | 13025/20000 [00:14<00:07, 895.35it/s]     66%|██████▌   | 13115/20000 [00:14<00:07, 895.51it/s]     66%|██████▌   | 13205/20000 [00:14<00:07, 894.95it/s]     66%|██████▋   | 13296/20000 [00:14<00:07, 896.90it/s]     67%|██████▋   | 13386/20000 [00:14<00:07, 892.09it/s]     67%|██████▋   | 13477/20000 [00:15<00:07, 894.71it/s]     68%|██████▊   | 13568/20000 [00:15<00:07, 897.70it/s]     68%|██████▊   | 13658/20000 [00:15<00:07, 894.90it/s]     69%|██████▊   | 13748/20000 [00:15<00:06, 893.27it/s]     69%|██████▉   | 13838/20000 [00:15<00:06, 891.05it/s]     70%|██████▉   | 13929/20000 [00:15<00:06, 893.97it/s]     70%|███████   | 14020/20000 [00:15<00:06, 896.72it/s]     71%|███████   | 14111/20000 [00:15<00:06, 897.83it/s]     71%|███████   | 14201/20000 [00:15<00:06, 897.82it/s]     71%|███████▏  | 14291/20000 [00:15<00:06, 895.47it/s]     72%|███████▏  | 14381/20000 [00:16<00:06, 893.43it/s]     72%|███████▏  | 14471/20000 [00:16<00:06, 893.41it/s]     73%|███████▎  | 14561/20000 [00:16<00:06, 894.92it/s]     73%|███████▎  | 14651/20000 [00:16<00:05, 895.25it/s]     74%|███████▎  | 14741/20000 [00:16<00:05, 896.24it/s]     74%|███████▍  | 14832/20000 [00:16<00:05, 897.91it/s]     75%|███████▍  | 14923/20000 [00:16<00:05, 899.11it/s]     75%|███████▌  | 15013/20000 [00:16<00:05, 897.39it/s]     76%|███████▌  | 15103/20000 [00:16<00:05, 897.28it/s]     76%|███████▌  | 15193/20000 [00:16<00:05, 896.22it/s]     76%|███████▋  | 15283/20000 [00:17<00:05, 896.65it/s]     77%|███████▋  | 15374/20000 [00:17<00:05, 898.59it/s]     77%|███████▋  | 15464/20000 [00:17<00:05, 898.26it/s]     78%|███████▊  | 15555/20000 [00:17<00:04, 899.47it/s]     78%|███████▊  | 15646/20000 [00:17<00:04, 900.68it/s]     79%|███████▊  | 15737/20000 [00:17<00:04, 900.90it/s]     79%|███████▉  | 15828/20000 [00:17<00:04, 901.79it/s]     80%|███████▉  | 15919/20000 [00:17<00:04, 902.30it/s]     80%|████████  | 16010/20000 [00:17<00:04, 900.37it/s]     81%|████████  | 16101/20000 [00:17<00:04, 899.03it/s]     81%|████████  | 16192/20000 [00:18<00:04, 899.45it/s]     81%|████████▏ | 16282/20000 [00:18<00:04, 898.90it/s]     82%|████████▏ | 16373/20000 [00:18<00:04, 899.50it/s]     82%|████████▏ | 16464/20000 [00:18<00:03, 899.75it/s]     83%|████████▎ | 16555/20000 [00:18<00:03, 901.26it/s]     83%|████████▎ | 16646/20000 [00:18<00:03, 900.02it/s]     84%|████████▎ | 16737/20000 [00:18<00:03, 899.64it/s]     84%|████████▍ | 16828/20000 [00:18<00:03, 900.51it/s]     85%|████████▍ | 16919/20000 [00:18<00:03, 900.01it/s]     85%|████████▌ | 17010/20000 [00:18<00:03, 901.26it/s]     86%|████████▌ | 17101/20000 [00:19<00:03, 901.90it/s]     86%|████████▌ | 17192/20000 [00:19<00:03, 902.12it/s]     86%|████████▋ | 17283/20000 [00:19<00:03, 902.27it/s]     87%|████████▋ | 17374/20000 [00:19<00:02, 902.21it/s]     87%|████████▋ | 17465/20000 [00:19<00:02, 902.83it/s]     88%|████████▊ | 17556/20000 [00:19<00:02, 901.69it/s]     88%|████████▊ | 17647/20000 [00:19<00:02, 902.51it/s]     89%|████████▊ | 17738/20000 [00:19<00:02, 900.65it/s]     89%|████████▉ | 17829/20000 [00:19<00:02, 900.70it/s]     90%|████████▉ | 17920/20000 [00:19<00:02, 901.76it/s]     90%|█████████ | 18011/20000 [00:20<00:02, 902.82it/s]     91%|█████████ | 18102/20000 [00:20<00:02, 901.03it/s]     91%|█████████ | 18193/20000 [00:20<00:02, 902.23it/s]     91%|█████████▏| 18284/20000 [00:20<00:01, 902.64it/s]     92%|█████████▏| 18375/20000 [00:20<00:01, 902.24it/s]     92%|█████████▏| 18466/20000 [00:20<00:01, 903.17it/s]     93%|█████████▎| 18557/20000 [00:20<00:01, 903.14it/s]     93%|█████████▎| 18648/20000 [00:20<00:01, 901.67it/s]     94%|█████████▎| 18739/20000 [00:20<00:01, 902.04it/s]     94%|█████████▍| 18830/20000 [00:20<00:01, 900.41it/s]     95%|█████████▍| 18921/20000 [00:21<00:01, 900.79it/s]     95%|█████████▌| 19012/20000 [00:21<00:01, 902.23it/s]     96%|█████████▌| 19103/20000 [00:21<00:00, 901.10it/s]     96%|█████████▌| 19194/20000 [00:21<00:00, 900.41it/s]     96%|█████████▋| 19285/20000 [00:21<00:00, 901.45it/s]     97%|█████████▋| 19376/20000 [00:21<00:00, 901.08it/s]     97%|█████████▋| 19467/20000 [00:21<00:00, 902.37it/s]     98%|█████████▊| 19558/20000 [00:21<00:00, 901.41it/s]     98%|█████████▊| 19649/20000 [00:21<00:00, 897.83it/s]     99%|█████████▊| 19740/20000 [00:22<00:00, 898.74it/s]     99%|█████████▉| 19830/20000 [00:22<00:00, 898.88it/s]    100%|█████████▉| 19921/20000 [00:22<00:00, 899.33it/s]    100%|██████████| 20000/20000 [00:22<00:00, 897.28it/s]




.. GENERATED FROM PYTHON SOURCE LINES 1448-1452

.. code-block:: Python


    sampler = inv_result_fixed_d_sampler.sampler
    az_idata = az.from_emcee(sampler, var_names=labels)








.. GENERATED FROM PYTHON SOURCE LINES 1454-1457

.. code-block:: Python


    az_idata.get("posterior")






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '►';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '▼';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
    Dimensions:  (chain: 40, draw: 2000)
    Coordinates:
      * chain    (chain) int64 0 1 2 3 4 5 6 7 8 9 ... 30 31 32 33 34 35 36 37 38 39
      * draw     (draw) int64 0 1 2 3 4 5 6 7 ... 1993 1994 1995 1996 1997 1998 1999
    Data variables: (12/17)
        v0       (chain, draw) float64 3.523 3.523 3.47 3.47 ... 3.385 3.385 3.385
        t0       (chain, draw) float64 15.35 15.35 15.25 15.25 ... 20.7 20.7 20.7
        v1       (chain, draw) float64 3.149 3.149 3.193 3.193 ... 3.627 3.627 3.627
        t1       (chain, draw) float64 14.67 14.67 14.67 14.67 ... 8.145 8.145 8.145
        v2       (chain, draw) float64 4.398 4.398 4.293 4.293 ... 4.053 4.053 4.053
        t2       (chain, draw) float64 14.63 14.63 14.83 14.83 ... 22.32 22.32 22.32
        ...       ...
        t5       (chain, draw) float64 15.21 15.21 15.22 15.22 ... 25.92 25.92 25.92
        v6       (chain, draw) float64 4.741 4.741 4.771 4.771 ... 4.511 4.511 4.511
        t6       (chain, draw) float64 15.23 15.23 15.17 15.17 ... 8.778 8.778 8.778
        v7       (chain, draw) float64 4.215 4.215 4.294 4.294 ... 3.954 3.954 3.954
        t7       (chain, draw) float64 14.57 14.57 14.67 14.67 ... 27.0 27.0 27.0
        v8       (chain, draw) float64 4.153 4.153 4.291 4.291 ... 4.629 4.629 4.629
    Attributes:
        created_at:                 2024-04-17T06:39:12.600786
        arviz_version:              0.17.0
        inference_library:          emcee
        inference_library_version:  3.1.4</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-2fa80171-2c8c-4aea-971e-d82e4c777b7f' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-2fa80171-2c8c-4aea-971e-d82e4c777b7f' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>chain</span>: 40</li><li><span class='xr-has-index'>draw</span>: 2000</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-3c205136-980e-46db-9972-d5d19badbdd0' class='xr-section-summary-in' type='checkbox'  checked><label for='section-3c205136-980e-46db-9972-d5d19badbdd0' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>chain</span></div><div class='xr-var-dims'>(chain)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 34 35 36 37 38 39</div><input id='attrs-3565a779-9531-4411-973d-6f559e8d4186' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3565a779-9531-4411-973d-6f559e8d4186' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b60e5e1d-0db2-4b83-ac39-0f7da23766e6' class='xr-var-data-in' type='checkbox'><label for='data-b60e5e1d-0db2-4b83-ac39-0f7da23766e6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
           18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,
           36, 37, 38, 39])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>draw</span></div><div class='xr-var-dims'>(draw)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 ... 1996 1997 1998 1999</div><input id='attrs-4f83a292-7ab1-41a5-9661-cabdf9eae571' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4f83a292-7ab1-41a5-9661-cabdf9eae571' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3a10e87a-0518-4ca8-8f41-8c93f05dfe09' class='xr-var-data-in' type='checkbox'><label for='data-3a10e87a-0518-4ca8-8f41-8c93f05dfe09' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([   0,    1,    2, ..., 1997, 1998, 1999])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-680b6cd0-4758-4d19-9c02-077542bb6cc2' class='xr-section-summary-in' type='checkbox'  ><label for='section-680b6cd0-4758-4d19-9c02-077542bb6cc2' class='xr-section-summary' >Data variables: <span>(17)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>v0</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.523 3.523 3.47 ... 3.385 3.385</div><input id='attrs-d8e09939-b6ac-43a6-82e0-d64cfc9ea672' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d8e09939-b6ac-43a6-82e0-d64cfc9ea672' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-052e225a-3dcd-4008-b6fa-3c315cc9b17b' class='xr-var-data-in' type='checkbox'><label for='data-052e225a-3dcd-4008-b6fa-3c315cc9b17b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[3.52270653, 3.52270653, 3.46967893, ..., 3.35488568, 3.35488568,
            3.35488568],
           [3.01690991, 3.03055891, 3.03055891, ..., 3.37009996, 3.37009996,
            3.37009996],
           [3.6121994 , 3.52606663, 3.52606663, ..., 3.38867105, 3.38867105,
            3.38867105],
           ...,
           [2.74852543, 2.90436918, 3.13450857, ..., 3.38371547, 3.38371547,
            3.38480729],
           [3.04584292, 3.04584292, 3.18957664, ..., 3.38466912, 3.38466912,
            3.38466912],
           [3.42342388, 3.41991243, 3.38603632, ..., 3.38462118, 3.38462118,
            3.38462118]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t0</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.35 15.35 15.25 ... 20.7 20.7</div><input id='attrs-8800b9b5-c035-4a49-b523-17ad3acf64c7' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8800b9b5-c035-4a49-b523-17ad3acf64c7' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-98fefcce-9dd3-4034-9884-4f962f3ce58b' class='xr-var-data-in' type='checkbox'><label for='data-98fefcce-9dd3-4034-9884-4f962f3ce58b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.35375898, 15.35375898, 15.24897595, ..., 13.09490077,
            13.09490077, 13.09490077],
           [15.08232226, 15.07921652, 15.07921652, ..., 10.94612232,
            10.94612232, 10.94612232],
           [14.65910999, 14.71071594, 14.71071594, ...,  9.59227651,
             9.59227651,  9.59227651],
           ...,
           [14.62862332, 14.79382151, 14.7644255 , ..., 15.64480438,
            15.64480438, 15.71877289],
           [15.03496667, 15.03496667, 14.91801488, ..., 14.69015545,
            14.69015545, 14.69015545],
           [15.06501437, 15.06474853, 14.96989732, ..., 20.70291507,
            20.70291507, 20.70291507]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v1</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.149 3.149 3.193 ... 3.627 3.627</div><input id='attrs-9dc99c4d-d802-43a8-b6f8-50a0d66f6a77' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9dc99c4d-d802-43a8-b6f8-50a0d66f6a77' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-af857925-ac89-442a-8948-fc77eed366de' class='xr-var-data-in' type='checkbox'><label for='data-af857925-ac89-442a-8948-fc77eed366de' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[3.14859836, 3.14859836, 3.19305483, ..., 3.54176986, 3.54176986,
            3.54176986],
           [3.59866568, 3.60423974, 3.60423974, ..., 3.43936896, 3.43936896,
            3.43936896],
           [3.48707255, 3.52923602, 3.52923602, ..., 3.44494393, 3.44494393,
            3.44494393],
           ...,
           [3.56371302, 3.65903999, 3.70490447, ..., 3.51165592, 3.51165592,
            3.50192195],
           [3.52376027, 3.52376027, 3.61060545, ..., 3.49873078, 3.49873078,
            3.49873078],
           [3.32391744, 3.33187979, 3.38325492, ..., 3.62734387, 3.62734387,
            3.62734387]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t1</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>14.67 14.67 14.67 ... 8.145 8.145</div><input id='attrs-d84608c6-e3e3-400c-87ed-1b670b24d4db' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d84608c6-e3e3-400c-87ed-1b670b24d4db' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1651f0a7-d7dc-4fcd-99e0-bcd05fc4e221' class='xr-var-data-in' type='checkbox'><label for='data-1651f0a7-d7dc-4fcd-99e0-bcd05fc4e221' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[14.66997156, 14.66997156, 14.6733895 , ..., 16.88253865,
            16.88253865, 16.88253865],
           [15.23729978, 15.23008079, 15.23008079, ..., 10.96943271,
            10.96943271, 10.96943271],
           [14.87956868, 14.8670973 , 14.8670973 , ..., 11.41653542,
            11.41653542, 11.41653542],
           ...,
           [14.87743375, 14.96720581, 15.02687413, ..., 17.28646395,
            17.28646395, 17.34140704],
           [14.9512976 , 14.9512976 , 14.94027694, ..., 16.7532115 ,
            16.7532115 , 16.7532115 ],
           [14.99413297, 14.99452614, 15.11768147, ...,  8.14486049,
             8.14486049,  8.14486049]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v2</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.398 4.398 4.293 ... 4.053 4.053</div><input id='attrs-226ec62b-59c3-4e91-bea6-f97f9e9a7b6f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-226ec62b-59c3-4e91-bea6-f97f9e9a7b6f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9d1d0b51-7b6a-4f67-b59b-43d3745a7407' class='xr-var-data-in' type='checkbox'><label for='data-9d1d0b51-7b6a-4f67-b59b-43d3745a7407' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.39831122, 4.39831122, 4.29310042, ..., 4.03190077, 4.03190077,
            4.03190077],
           [3.67761965, 3.68323167, 3.68323167, ..., 3.86730135, 3.86730135,
            3.86730135],
           [4.23496658, 4.19606668, 4.19606668, ..., 3.54981577, 3.54981577,
            3.54981577],
           ...,
           [4.15425234, 4.07975815, 3.98233473, ..., 4.74370782, 4.74370782,
            4.79850227],
           [4.06285467, 4.06285467, 4.0797634 , ..., 4.46630442, 4.46630442,
            4.46630442],
           [4.2293093 , 4.2244851 , 4.18986789, ..., 4.05301902, 4.05301902,
            4.05301902]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t2</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>14.63 14.63 14.83 ... 22.32 22.32</div><input id='attrs-a2ea7a62-97f3-4784-85ab-2952674455a6' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a2ea7a62-97f3-4784-85ab-2952674455a6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fe0eb4ba-7c0e-43b1-853e-41a6cbebe7da' class='xr-var-data-in' type='checkbox'><label for='data-fe0eb4ba-7c0e-43b1-853e-41a6cbebe7da' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[14.62875612, 14.62875612, 14.83191617, ...,  5.97580176,
             5.97580176,  5.97580176],
           [15.26548181, 15.2534409 , 15.2534409 , ..., 27.50223515,
            27.50223515, 27.50223515],
           [15.09552291, 15.04268206, 15.04268206, ..., 11.5715796 ,
            11.5715796 , 11.5715796 ],
           ...,
           [15.06604869, 15.06875271, 14.94919728, ..., 17.1918016 ,
            17.1918016 , 16.88431142],
           [15.21574235, 15.21574235, 15.02155268, ..., 18.05843308,
            18.05843308, 18.05843308],
           [14.61518532, 14.62217871, 14.67127399, ..., 22.32447192,
            22.32447192, 22.32447192]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v3</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.481 4.481 4.449 ... 4.298 4.298</div><input id='attrs-b53c2ba7-58c8-42d6-b001-03b27fdcb85e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b53c2ba7-58c8-42d6-b001-03b27fdcb85e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-352e1ec8-e29b-4fc2-9c20-7cab06d675dd' class='xr-var-data-in' type='checkbox'><label for='data-352e1ec8-e29b-4fc2-9c20-7cab06d675dd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.48085512, 4.48085512, 4.44874164, ..., 3.88295436, 3.88295436,
            3.88295436],
           [4.56571822, 4.55901573, 4.55901573, ..., 4.60919625, 4.60919625,
            4.60919625],
           [4.34330764, 4.42448173, 4.42448173, ..., 4.49563465, 4.49563465,
            4.49563465],
           ...,
           [3.72346257, 3.99775215, 4.1497197 , ..., 3.79517048, 3.79517048,
            3.79021121],
           [3.81447154, 3.81447154, 3.92802307, ..., 4.10107882, 4.10107882,
            4.10107882],
           [4.33495789, 4.33532468, 4.35035624, ..., 4.29818902, 4.29818902,
            4.29818902]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t3</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.02 15.02 15.12 ... 14.12 14.12</div><input id='attrs-fafbc26a-0807-4e88-871a-53194cb1d77d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-fafbc26a-0807-4e88-871a-53194cb1d77d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f373851b-f823-421d-a549-799639dd83fb' class='xr-var-data-in' type='checkbox'><label for='data-f373851b-f823-421d-a549-799639dd83fb' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.01682633, 15.01682633, 15.11695361, ...,  8.00384661,
             8.00384661,  8.00384661],
           [14.83711811, 14.84041382, 14.84041382, ..., 29.01942736,
            29.01942736, 29.01942736],
           [15.73787077, 15.60412363, 15.60412363, ..., 15.11781779,
            15.11781779, 15.11781779],
           ...,
           [15.41255137, 15.48626859, 15.17118304, ..., 16.47822951,
            16.47822951, 17.2381078 ],
           [14.72821423, 14.72821423, 14.82335393, ...,  9.25600891,
             9.25600891,  9.25600891],
           [15.188952  , 15.18626216, 15.23367864, ..., 14.11937757,
            14.11937757, 14.11937757]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v4</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.178 4.178 4.214 ... 4.992 4.992</div><input id='attrs-041f605a-3bd5-4963-b346-338f1c94cf6f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-041f605a-3bd5-4963-b346-338f1c94cf6f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c5420391-1f9e-45bc-a3dd-336ed9035261' class='xr-var-data-in' type='checkbox'><label for='data-c5420391-1f9e-45bc-a3dd-336ed9035261' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.17837387, 4.17837387, 4.21364638, ..., 4.52923117, 4.52923117,
            4.52923117],
           [4.07293635, 4.08178285, 4.08178285, ..., 4.43737783, 4.43737783,
            4.43737783],
           [4.24614113, 4.27832401, 4.27832401, ..., 4.24866274, 4.24866274,
            4.24866274],
           ...,
           [4.18952532, 4.21425323, 4.1958062 , ..., 4.68260508, 4.68260508,
            4.71571808],
           [4.32121141, 4.32121141, 4.45550505, ..., 4.04022766, 4.04022766,
            4.04022766],
           [4.1904269 , 4.19059751, 4.18108805, ..., 4.99169862, 4.99169862,
            4.99169862]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t4</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.0 15.0 15.01 ... 5.882 5.882</div><input id='attrs-0be9aab8-a19e-4e54-a70f-037e5a88aca5' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0be9aab8-a19e-4e54-a70f-037e5a88aca5' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7fa83507-a9e3-44c2-9d6e-af1310ed878e' class='xr-var-data-in' type='checkbox'><label for='data-7fa83507-a9e3-44c2-9d6e-af1310ed878e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.00076004, 15.00076004, 15.01229687, ..., 19.32539342,
            19.32539342, 19.32539342],
           [15.34306176, 15.3295544 , 15.3295544 , ..., 12.78269152,
            12.78269152, 12.78269152],
           [14.87661009, 14.94535342, 14.94535342, ..., 19.97360514,
            19.97360514, 19.97360514],
           ...,
           [14.75170759, 14.90333589, 14.99819388, ..., 13.84152946,
            13.84152946, 14.24889228],
           [14.64535809, 14.64535809, 14.68229113, ..., 17.72800469,
            17.72800469, 17.72800469],
           [15.31581464, 15.31382539, 15.04681378, ...,  5.88154719,
             5.88154719,  5.88154719]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v5</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.992 3.992 4.046 ... 4.45 4.45</div><input id='attrs-5cb43703-5c45-404f-8de7-50837c33b97e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-5cb43703-5c45-404f-8de7-50837c33b97e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1f622973-6825-41eb-aa68-30fac02b7572' class='xr-var-data-in' type='checkbox'><label for='data-1f622973-6825-41eb-aa68-30fac02b7572' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[3.99235964, 3.99235964, 4.04553143, ..., 4.33911316, 4.33911316,
            4.33911316],
           [4.21055029, 4.21930177, 4.21930177, ..., 3.95685702, 3.95685702,
            3.95685702],
           [3.96215028, 3.99759251, 3.99759251, ..., 4.02522742, 4.02522742,
            4.02522742],
           ...,
           [4.33468405, 4.42928686, 4.43258532, ..., 4.55745679, 4.55745679,
            4.53561656],
           [4.32300941, 4.32300941, 4.26562409, ..., 4.52611006, 4.52611006,
            4.52611006],
           [4.17327628, 4.1754516 , 4.47155018, ..., 4.44955968, 4.44955968,
            4.44955968]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t5</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.21 15.21 15.22 ... 25.92 25.92</div><input id='attrs-d83526fc-f54e-497c-91ee-7e6efccb47f7' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d83526fc-f54e-497c-91ee-7e6efccb47f7' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f13250a2-b42e-42ac-97e2-8a63c7102791' class='xr-var-data-in' type='checkbox'><label for='data-f13250a2-b42e-42ac-97e2-8a63c7102791' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.20556197, 15.20556197, 15.22017408, ..., 18.51973149,
            18.51973149, 18.51973149],
           [15.02575553, 15.03073572, 15.03073572, ..., 19.26811439,
            19.26811439, 19.26811439],
           [14.53704866, 14.6880555 , 14.6880555 , ..., 20.26129561,
            20.26129561, 20.26129561],
           ...,
           [14.98596715, 14.91646958, 14.96246261, ..., 20.45609585,
            20.45609585, 20.40394777],
           [14.9831471 , 14.9831471 , 15.07883412, ..., 20.92533572,
            20.92533572, 20.92533572],
           [14.74245463, 14.74739908, 14.68664004, ..., 25.92284272,
            25.92284272, 25.92284272]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v6</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.741 4.741 4.771 ... 4.511 4.511</div><input id='attrs-ea964f8b-993d-4a9f-86f8-8e3db69db03a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ea964f8b-993d-4a9f-86f8-8e3db69db03a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-303c8883-d99c-4037-a7ba-b926925f6d94' class='xr-var-data-in' type='checkbox'><label for='data-303c8883-d99c-4037-a7ba-b926925f6d94' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.74071527, 4.74071527, 4.77076119, ..., 4.44822298, 4.44822298,
            4.44822298],
           [4.34237154, 4.34489416, 4.34489416, ..., 4.74936355, 4.74936355,
            4.74936355],
           [3.89526619, 3.99394837, 3.99394837, ..., 4.88013301, 4.88013301,
            4.88013301],
           ...,
           [4.55486175, 4.62731528, 4.38145563, ..., 4.77305566, 4.77305566,
            4.90038765],
           [3.84023441, 3.84023441, 3.89258229, ..., 4.81020119, 4.81020119,
            4.81020119],
           [4.42563021, 4.42402097, 4.32276838, ..., 4.51140013, 4.51140013,
            4.51140013]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t6</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.23 15.23 15.17 ... 8.778 8.778</div><input id='attrs-944b8b41-70c7-4c86-8920-0a6e90210055' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-944b8b41-70c7-4c86-8920-0a6e90210055' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f07bb2c2-8536-4630-967c-9f639ed14ab5' class='xr-var-data-in' type='checkbox'><label for='data-f07bb2c2-8536-4630-967c-9f639ed14ab5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.22521046, 15.22521046, 15.17166768, ..., 22.39795071,
            22.39795071, 22.39795071],
           [14.73507565, 14.73403487, 14.73403487, ..., 10.62498247,
            10.62498247, 10.62498247],
           [14.7818781 , 14.72882271, 14.72882271, ..., 28.8045881 ,
            28.8045881 , 28.8045881 ],
           ...,
           [15.05219814, 14.93973591, 14.95833274, ..., 16.8853848 ,
            16.8853848 , 17.20531292],
           [14.56153314, 14.56153314, 14.81110599, ..., 13.73276489,
            13.73276489, 13.73276489],
           [15.60405541, 15.59300552, 15.39612747, ...,  8.77768482,
             8.77768482,  8.77768482]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v7</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.215 4.215 4.294 ... 3.954 3.954</div><input id='attrs-4c2e7723-246e-4ae5-a3b1-0d420293c719' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4c2e7723-246e-4ae5-a3b1-0d420293c719' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-18a31099-fb56-43f8-a58d-e3013cb57a3c' class='xr-var-data-in' type='checkbox'><label for='data-18a31099-fb56-43f8-a58d-e3013cb57a3c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.21490039, 4.21490039, 4.29397805, ..., 3.43676363, 3.43676363,
            3.43676363],
           [4.16226328, 4.16433708, 4.16433708, ..., 3.79826189, 3.79826189,
            3.79826189],
           [4.60340927, 4.43092099, 4.43092099, ..., 4.08471653, 4.08471653,
            4.08471653],
           ...,
           [4.56193915, 4.52922967, 4.34326809, ..., 3.85944735, 3.85944735,
            3.74967418],
           [3.42325087, 3.42325087, 3.6746652 , ..., 4.54805544, 4.54805544,
            4.54805544],
           [4.23208353, 4.23139196, 4.19282704, ..., 3.95401999, 3.95401999,
            3.95401999]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t7</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>14.57 14.57 14.67 ... 27.0 27.0</div><input id='attrs-1c521db7-69fd-45e4-9f9e-ddd5312010a2' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1c521db7-69fd-45e4-9f9e-ddd5312010a2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-93e42428-d46a-41a7-8094-7a3b253b7dc7' class='xr-var-data-in' type='checkbox'><label for='data-93e42428-d46a-41a7-8094-7a3b253b7dc7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[14.56877687, 14.56877687, 14.67192258, ..., 12.54781826,
            12.54781826, 12.54781826],
           [15.16531082, 15.16598177, 15.16598177, ...,  8.98146558,
             8.98146558,  8.98146558],
           [15.00842713, 14.96990782, 14.96990782, ..., 26.39656774,
            26.39656774, 26.39656774],
           ...,
           [14.74171311, 14.84584891, 15.08603344, ..., 12.19681897,
            12.19681897, 11.89590373],
           [14.63047694, 14.63047694, 14.77699591, ..., 15.04872264,
            15.04872264, 15.04872264],
           [15.18047837, 15.17324338, 15.09855693, ..., 27.00190599,
            27.00190599, 27.00190599]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v8</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.153 4.153 4.291 ... 4.629 4.629</div><input id='attrs-2bf3702a-e5cf-4b0b-ab42-c6f891fc9b12' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2bf3702a-e5cf-4b0b-ab42-c6f891fc9b12' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1ac599fc-0bc5-410f-abb5-6ff4dd899d39' class='xr-var-data-in' type='checkbox'><label for='data-1ac599fc-0bc5-410f-abb5-6ff4dd899d39' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.15297213, 4.15297213, 4.29083412, ..., 4.62847825, 4.62847825,
            4.62847825],
           [4.69235364, 4.68894771, 4.68894771, ..., 4.59312641, 4.59312641,
            4.59312641],
           [4.56915204, 4.47375559, 4.47375559, ..., 4.50075937, 4.50075937,
            4.50075937],
           ...,
           [4.55510611, 4.54690874, 4.6022287 , ..., 4.4583008 , 4.4583008 ,
            4.44548313],
           [4.51544982, 4.51544982, 4.54941136, ..., 4.36657309, 4.36657309,
            4.36657309],
           [4.35995122, 4.3637472 , 4.48369791, ..., 4.62929313, 4.62929313,
            4.62929313]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-69e8bab2-36d8-40e1-a2ac-a2690fef46dc' class='xr-section-summary-in' type='checkbox'  ><label for='section-69e8bab2-36d8-40e1-a2ac-a2690fef46dc' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>chain</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-ba4adb21-a174-4fc9-b232-c316fb7199c3' class='xr-index-data-in' type='checkbox'/><label for='index-ba4adb21-a174-4fc9-b232-c316fb7199c3' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
           18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,
           36, 37, 38, 39],
          dtype=&#x27;int64&#x27;, name=&#x27;chain&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>draw</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-ef08328b-8f08-40e3-b47a-adbcde158696' class='xr-index-data-in' type='checkbox'/><label for='index-ef08328b-8f08-40e3-b47a-adbcde158696' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([   0,    1,    2,    3,    4,    5,    6,    7,    8,    9,
           ...
           1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999],
          dtype=&#x27;int64&#x27;, name=&#x27;draw&#x27;, length=2000))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-03b5c77f-4343-451f-a576-3e43b1554705' class='xr-section-summary-in' type='checkbox'  checked><label for='section-03b5c77f-4343-451f-a576-3e43b1554705' class='xr-section-summary' >Attributes: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>created_at :</span></dt><dd>2024-04-17T06:39:12.600786</dd><dt><span>arviz_version :</span></dt><dd>0.17.0</dd><dt><span>inference_library :</span></dt><dd>emcee</dd><dt><span>inference_library_version :</span></dt><dd>3.1.4</dd></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 1459-1494

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="starting model", color_model="black",
                               forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                               label_d_pred="d_pred from starting model", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=ref_good_model, label_model="reference good model", color_model="red",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                        label_d_pred="d_pred from reference good model", color_d_pred="red", axes=axes)

    # plot the model and d_pred for inverted model, and d_obs
    plot_model_and_data(model=inv_result_sw_field.model, 
                        label_model="inverted model from field data", color_model="green",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace,
                        label_d_pred="d_pred from inverted model", color_d_pred="green", axes=axes)

    # plot randomly selected samples and data predictions from samples
    flat_samples = sampler.get_chain(discard=1000, thin=300, flat=True)
    rand_indices = np.random.randint(len(flat_samples), size=100)
    for idx in rand_indices:
        sample = flat_samples[idx]
        label_model = "sample models" if idx == 0 else None
        label_d_pred = "d_pred from samples" if idx == 0 else None
        plot_model_and_data(model=sample, label_model=label_model, color_model="gray",
                            forward_func=forward_sw_interp, periods=field_d_periods_logspace,
                            label_d_pred=label_d_pred, color_d_pred="gray", axes=axes, light_thin=True)

    # plot d_obs
    plot_data(field_d_obs, field_d_periods, ax=axes[1], scatter=True, color="orange", s=8, label="d_obs")

    axes[0].set_ylim(100, 0)
    axes[0].legend(loc="lower center", bbox_to_anchor=(0.5, -0.4))
    axes[1].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46));




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_015.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_015.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f81e2693a60>



.. GENERATED FROM PYTHON SOURCE LINES 1499-1513

**More steps**

Similar to our earlier fixed-dimensional sampling run on the synthetic
data, we are not sampling enough due to time limit.

On a seperate experiment, we ran 200_000 steps and produced the
following samples plot.

.. figure:: illustrations/emcee_200_000_iterations_field.png
   :alt: Fixed-dimensional sampling results on field data with 200_000
   steps

   Fixed-dimensional sampling results on field data with 200_000 steps


.. GENERATED FROM PYTHON SOURCE LINES 1516-1519

Trans-dimensional sampling
~~~~~~~~~~~~~~~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 1519-1528

.. code-block:: Python


    def forward_interp_for_bayesbay(state):
        vs = state["voronoi"]["vs"]
        voronoi_sites = state["voronoi"]["discretization"]
        depths = (voronoi_sites[:-1] + voronoi_sites[1:]) / 2
        thicknesses = depths - np.insert(depths[:-1], 0, 0)
        model = form_layercake_model(thicknesses, vs)
        return forward_sw_interp(model, field_d_periods)








.. GENERATED FROM PYTHON SOURCE LINES 1530-1535

.. code-block:: Python


    targets = [bayesbay.Target("rayleigh", field_d_obs, covariance_mat_inv=1/noise_level**2)]
    fwd_funcs = [forward_interp_for_bayesbay]
    my_log_likelihood = bayesbay.LogLikelihood(targets, fwd_funcs)








.. GENERATED FROM PYTHON SOURCE LINES 1537-1560

.. code-block:: Python


    param_vs = bayesbay.prior.UniformPrior(
        name="vs", 
        vmin=[2.7, 3.2, 3.75], 
        vmax=[4, 4.75, 5], 
        position=[0, 40, 80], 
        perturb_std=0.15
    )

    def param_vs_initialize(param, positions): 
        vmin, vmax = param.get_vmin_vmax(positions)
        sorted_vals = np.sort(np.random.uniform(vmin, vmax, positions.size))
        for i in range (len(sorted_vals)):
            val = sorted_vals[i]
            vmin_i = vmin if np.isscalar(vmin) else vmin[i]
            vmax_i = vmax if np.isscalar(vmax) else vmax[i]
            if val < vmin_i or val > vmax_i:
                if val > vmax_i: sorted_vals[i] = vmax_i
                if val < vmin_i: sorted_vals[i] = vmin_i
        return sorted_vals

    param_vs.set_custom_initialize(param_vs_initialize)








.. GENERATED FROM PYTHON SOURCE LINES 1562-1577

.. code-block:: Python


    parameterization = bayesbay.parameterization.Parameterization(
        bayesbay.discretization.Voronoi1D(
            name="voronoi", 
            vmin=0, 
            vmax=150, 
            perturb_std=10, 
            n_dimensions=None, 
            n_dimensions_min=4, 
            n_dimensions_max=20, 
            parameters=[param_vs], 
        )
    )
    my_perturbation_funcs = parameterization.perturbation_functions








.. GENERATED FROM PYTHON SOURCE LINES 1579-1585

.. code-block:: Python


    n_chains=12
    walkers_start = []
    for i in range(n_chains):
        walkers_start.append(parameterization.initialize())








.. GENERATED FROM PYTHON SOURCE LINES 1590-1592

**Define ``InversionOptions``**


.. GENERATED FROM PYTHON SOURCE LINES 1592-1606

.. code-block:: Python


    inv_options_field_trans_d_sampling = cofi.InversionOptions()
    inv_options_field_trans_d_sampling.set_tool("bayesbay")
    inv_options_field_trans_d_sampling.set_params(
        walkers_starting_states=walkers_start,
        perturbation_funcs=my_perturbation_funcs,
        log_like_ratio_func=my_log_likelihood,
        n_chains=n_chains, 
        n_iterations=3_000, 
        burnin_iterations=1_000,
        verbose=False, 
        save_every=200, 
    )








.. GENERATED FROM PYTHON SOURCE LINES 1611-1613

**Define ``Inversion`` and run**


.. GENERATED FROM PYTHON SOURCE LINES 1613-1618

.. code-block:: Python


    inversion_field_trans_d_sampler = cofi.Inversion(sw_field_problem, 
                                                     inv_options_field_trans_d_sampling)
    inv_result_field_trans_d_sampler = inversion_field_trans_d_sampler.run()








.. GENERATED FROM PYTHON SOURCE LINES 1620-1627

.. code-block:: Python


    inverted_models = inv_result_field_trans_d_sampler.models
    samples = []
    for v, vs in zip(inverted_models["voronoi.discretization"], inverted_models["voronoi.vs"]):
        sample = form_voronoi_model(v, vs)
        samples.append(voronoi_to_layercake(sample))








.. GENERATED FROM PYTHON SOURCE LINES 1629-1663

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="starting model", color_model="black",
                               forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                               label_d_pred="d_pred from starting model", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=ref_good_model, label_model="reference good model", color_model="red",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                        label_d_pred="d_pred from reference good model", color_d_pred="red", axes=axes)

    # plot the model and d_pred for inverted model, and d_obs
    plot_model_and_data(model=inv_result_sw_field.model, 
                        label_model="inverted model from field data", color_model="green",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace,
                        label_d_pred="d_pred from inverted model", color_d_pred="green", axes=axes)

    # plot randomly selected samples and data predictions from samples
    flat_samples = sampler.get_chain(discard=1000, thin=300, flat=True)
    rand_indices = np.random.randint(len(flat_samples), size=100)
    for i, sample in enumerate(samples):
        label_model = "sample models" if i == 0 else None
        label_d_pred = "d_pred from samples" if i == 0 else None
        plot_model_and_data(model=sample, label_model=label_model, color_model="gray",
                            forward_func=forward_sw_interp, periods=field_d_periods_logspace,
                            label_d_pred=label_d_pred, color_d_pred="gray", axes=axes, light_thin=True)

    # plot d_obs
    plot_data(field_d_obs, field_d_periods, ax=axes[1], scatter=True, color="orange", s=8, label="d_obs")

    axes[0].set_ylim(100, 0)
    axes[0].legend(loc="lower center", bbox_to_anchor=(0.5, -0.4))
    axes[1].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46));




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_016.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_016.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f81e25e70a0>



.. GENERATED FROM PYTHON SOURCE LINES 1668-1673

--------------

Watermark
---------


.. GENERATED FROM PYTHON SOURCE LINES 1673-1679

.. code-block:: Python


    watermark_list = ["cofi", "numpy", "matplotlib", "scipy", "emcee", "bayesbay"]
    for pkg in watermark_list:
        pkg_var = __import__(pkg)
        print(pkg, getattr(pkg_var, "__version__"))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    cofi 0.2.7
    numpy 1.24.4
    matplotlib 3.8.3
    scipy 1.12.0
    emcee 3.1.4
    bayesbay 0.2.0




.. GENERATED FROM PYTHON SOURCE LINES 1680-1680

sphinx_gallery_thumbnail_number = -1


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (4 minutes 54.149 seconds)


.. _sphx_glr_download_tutorials_generated_1D_rayleigh_wave_phase_velocity_inversion.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: 1D_rayleigh_wave_phase_velocity_inversion.ipynb <1D_rayleigh_wave_phase_velocity_inversion.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: 1D_rayleigh_wave_phase_velocity_inversion.py <1D_rayleigh_wave_phase_velocity_inversion.py>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
